{% macro breadcrumbs(page_type, page_data=none, path_prefix="") -%}
<nav aria-label="breadcrumb" style="margin-bottom: 10px;">
    <ol class="breadcrumb" style="background: none; padding: 0; margin: 0; font-size: 0.9em; list-style: none;">
        <li style="display: inline;"><a href="{{ path_prefix }}index.html">Home</a></li>
        {% if page_type == 'as_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/networks-by-bandwidth.html">Browse by Network</a></li>
            <li style="display: inline; color: #777;"> > {{ page_data.as_number }}</li>
        {% elif page_type == 'contact_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/contacts-by-bandwidth.html">Browse by Contact</a></li>
            <li style="display: inline; color: #777;"> > {% if page_data.aroi_domain and page_data.aroi_domain != 'none' %}{{ page_data.aroi_domain }}{% else %}{{ page_data.contact_hash[:8] }}{% endif %}</li>
        {% elif page_type == 'country_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/countries-by-bandwidth.html">Browse by Country</a></li>
            <li style="display: inline; color: #777;"> > {{ page_data.country_name }}</li>
        {% elif page_type == 'family_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/families-by-bandwidth.html">Browse by Family</a></li>
            <li style="display: inline; color: #777;"> > {% if page_data.aroi_domain and page_data.aroi_domain != 'none' %}{{ page_data.aroi_domain }}{% else %}{{ page_data.family_hash[:8] }}{% endif %}</li>
        {% elif page_type == 'platform_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/platforms-by-bandwidth.html">Browse by Platform</a></li>
            <li style="display: inline; color: #777;"> > {{ page_data.platform_name }}</li>
        {% elif page_type == 'first_seen_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/all.html">All Relays</a></li>
            <li style="display: inline; color: #777;"> > First Seen {{ page_data.date }}</li>
        {% elif page_type == 'flag_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/all.html">All Relays</a></li>
            <li style="display: inline; color: #777;"> > {{ page_data.flag_name|title }} Relays</li>
        {% elif page_type == 'relay_detail' and page_data %}
            <li style="display: inline;"> > <a href="{{ path_prefix }}misc/networks-by-bandwidth.html">Browse by Network</a></li>
            {% if page_data.as_number %}
                <li style="display: inline;"> > <a href="{{ path_prefix }}as/{{ page_data.as_number }}/">{{ page_data.as_number }}</a></li>
            {% endif %}
            <li style="display: inline; color: #777;"> > {{ page_data.nickname }}</li>
        {% elif page_type == 'home' and page_data %}
            <li style="display: inline; color: #777;"> > {{ page_data.page_name }}</li>
        {% elif page_type == 'misc_listing' and page_data %}
            <li style="display: inline; color: #777;"> > {{ page_data.page_name }}</li>
        {% endif %}
    </ol>
</nav>
{%- endmacro %}

{# =============================================================================
   SEARCH FORM MACRO (DRY - reusable search input with security attributes)
   ============================================================================= #}
{% macro search_input(path_prefix, variant='desktop') -%}
{#
    Renders a search input field with proper security attributes.
    
    Args:
        path_prefix: URL path prefix for the search action
        variant: 'desktop' (compact) or 'mobile' (full-width)
    
    Security attributes applied:
        - maxlength: Prevents DoS via extremely long queries
        - pattern: Client-side validation (defense-in-depth)
        - autocomplete=off: Prevents sensitive data leakage
        - spellcheck=false: Prevents data being sent to spell-check services
#}
{% set placeholder = "Search relays..." if variant == 'desktop' else "Search: fingerprint, nickname, AROI, IP, AS number, family, country..." %}
{% set input_class = "form-control input-sm" if variant == 'desktop' else "form-control" %}
{% set btn_class = "btn btn-sm btn-default" if variant == 'desktop' else "btn btn-primary" %}
{% set btn_content = '<span class="glyphicon glyphicon-search" aria-hidden="true"></span>' if variant == 'desktop' else 'Search' %}
<input type="text" 
       name="q" 
       class="{{ input_class }}" 
       placeholder="{{ placeholder }}"
       title="Search by fingerprint, nickname, AROI, IP, AS number, family, or country"
       maxlength="100"
       pattern="[A-Za-z0-9\s\-_.@:]+"
       autocomplete="off"
       autocapitalize="off"
       spellcheck="false">
<span class="input-group-btn">
    <button type="submit" class="{{ btn_class }}">{{ btn_content | safe }}</button>
</span>
{%- endmacro %}

{% macro navigation(active_section, page_ctx={'path_prefix': ''}, show_breadcrumbs=true) -%}
    {% if show_breadcrumbs and page_ctx.breadcrumb_type and page_ctx.breadcrumb_data %}
        {{ breadcrumbs(page_ctx.breadcrumb_type, page_ctx.breadcrumb_data, page_ctx.path_prefix) }}
    {% endif %}
    <nav class="navbar navbar-default" style="margin-bottom: 20px;">
        <div class="container-fluid">
            <!-- CSS-only hamburger toggle using checkbox hack -->
            <input type="checkbox" id="navbar-toggle" class="navbar-toggle-checkbox" style="display: none;">
            
            <div class="navbar-header">
                <label for="navbar-toggle" class="navbar-toggle" role="button" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </label>
                <span class="navbar-brand visible-xs">Browse Categories</span>
            </div>
            
            <div class="navbar-collapse" id="main-navbar">
                <ul class="nav navbar-nav">
                    <li class="{% if active_section == 'network_health' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}network-health.html">Network Health</a>
                    </li>
                    <li class="{% if active_section == 'aroi' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}index.html">Operator Champions</a>
                    </li>
                    <li class="{% if active_section == 'contacts' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/contacts-by-bandwidth.html">By Operator / Contact</a>
                    </li>
                    <li class="{% if active_section == 'families' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/families-by-bandwidth.html">By Family</a>
                    </li>
                    <li class="{% if active_section == 'networks' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/networks-by-bandwidth.html">By Network</a>
                    </li>
                    <li class="{% if active_section == 'countries' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/countries-by-bandwidth.html">By Country</a>
                    </li>
                    <li class="{% if active_section == 'platforms' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/platforms-by-bandwidth.html">By Platform</a>
                    </li>
                    <li class="{% if active_section == 'authorities' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/authorities.html">Directory Authorities</a>
                    </li>
                    <li class="{% if active_section == 'top500' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}top500.html">Top 500 Relays</a>
                    </li>
                    <li class="{% if active_section == 'all' %}active{% endif %}">
                        <a href="{{ page_ctx.path_prefix }}misc/all.html">All Relays</a>
                    </li>
                </ul>
                
                <!-- Desktop: Search in navbar (hidden on mobile via CSS) -->
                <form action="{{ page_ctx.path_prefix }}search" method="GET" 
                      class="navbar-form navbar-right hidden-xs hidden-sm"
                      style="margin-right: 0;">
                    <div class="input-group" style="width: 220px;">
                        {{ search_input(page_ctx.path_prefix, 'desktop') }}
                    </div>
                </form>
            </div>
        </div>
    </nav>
    
    <!-- Mobile: Search bar below navbar (hidden on desktop via CSS) -->
    <div class="allium-mobile-search visible-xs visible-sm">
        <form action="{{ page_ctx.path_prefix }}search" method="GET">
            <div class="input-group">
                {{ search_input(page_ctx.path_prefix, 'mobile') }}
            </div>
        </form>
    </div>
{%- endmacro %}

{% macro detail_summary(bandwidth, bandwidth_unit, guard_bandwidth, middle_bandwidth, exit_bandwidth, consensus_weight_fraction, guard_consensus_weight_fraction, middle_consensus_weight_fraction, exit_consensus_weight_fraction, guard_count, middle_count, exit_count, total_relays, network_position, aroi_domain=none, contact=none, contact_md5=none, page_ctx=none, unique_aroi_list=none, unique_contact_list=none, unique_aroi_count=none, unique_contact_count=none, unique_aroi_contact_html=none, aroi_to_contact_map=none, contact_validation_status=none, family_support_counts=none) -%}
<ul style="list-style-type: disc; padding-left: 20px; margin-bottom: 15px;">
    <li><strong><span title="Observed bandwidth capacity represents the estimated maximum throughput this group can handle, combining total, guard, middle, and exit bandwidth contributions">Bandwidth Capacity</span>:</strong> ~{{ bandwidth }} {{ bandwidth_unit }}
        {%- if guard_count > 0 or middle_count > 0 or exit_count > 0 %} 
        (<span title="Bandwidth capacity dedicated to guard relay operations">{{ guard_bandwidth }} {{ bandwidth_unit }} guard capacity</span>
        {%- if middle_count > 0 %}, <span title="Bandwidth capacity dedicated to middle relay operations">{{ middle_bandwidth }} {{ bandwidth_unit }} middle capacity</span>{% endif -%}
        {%- if exit_count > 0 %}, <span title="Bandwidth capacity dedicated to exit relay operations">{{ exit_bandwidth }} {{ bandwidth_unit }} exit capacity</span>{% endif -%}
        )
        {%- endif %}</li>
    <li><strong><span title="Network influence represents the percentage of overall consensus weight, indicating relative importance in the Tor network across guard, middle, and exit positions">Network Influence</span>:</strong> {{ "%.2f%%"|format(consensus_weight_fraction * 100) }} of overall consensus weight
        {%- if guard_count > 0 or middle_count > 0 or exit_count > 0 %} 
        (<span title="Percentage of guard consensus weight for entry position selection">{{ "%.2f%%"|format(guard_consensus_weight_fraction * 100) }} guard</span>
        {%- if middle_count > 0 %}, <span title="Percentage of middle consensus weight for routing position selection">{{ "%.2f%%"|format(middle_consensus_weight_fraction * 100) }} middle</span>{% endif -%}
        {%- if exit_count > 0 %}, and <span title="Percentage of exit consensus weight for exit position selection">{{ "%.2f%%"|format(exit_consensus_weight_fraction * 100) }} exit</span>{% endif -%}
        )
        {%- endif %}</li>
    <li><strong><span title="Network position indicates the strategic role distribution of relays. Labels: Guard-focused (>60% guard), Exit-focused (>40% exit), Multi-role (both guard and exit >20%), Balanced (mixed roles), Guard-only (100% guard), Exit-only (100% exit), Middle-only (100% middle)">Network Position</span>:</strong> {{ network_position.formatted_string }}</li>
    {%- if family_support_counts %}
    {% set fsc = family_support_counts %}
    {% set fsc_total = fsc.get('both', 0) + fsc.get('happy_families', 0) + fsc.get('my_family', 0) + fsc.get('none', 0) %}
    {% if fsc_total > 0 %}
    <li><strong><span title="Family membership method breakdown per relay: Both = Happy Families (family-cert) and MyFamily, Happy Families = family-cert only, MyFamily = legacy only, None = no family membership. Source: CollecTor server descriptors.">Family Support</span>:</strong>
        {% if fsc.get('both', 0) > 0 %}<span style="color: #28a745;">{{ fsc.both }} Both, Happy Families and MyFamily ({{ (fsc.both / fsc_total * 100)|round(0)|int }}%)</span>{% if fsc.get('happy_families', 0) > 0 or fsc.get('my_family', 0) > 0 or fsc.get('none', 0) > 0 %}, {% endif %}{% endif %}
        {% if fsc.get('happy_families', 0) > 0 %}<span style="color: #28a745;">{{ fsc.happy_families }} Happy Families ({{ (fsc.happy_families / fsc_total * 100)|round(0)|int }}%)</span>{% if fsc.get('my_family', 0) > 0 or fsc.get('none', 0) > 0 %}, {% endif %}{% endif %}
        {% if fsc.get('my_family', 0) > 0 %}<span style="color: #dc3545;">{{ fsc.my_family }} MyFamily ({{ (fsc.my_family / fsc_total * 100)|round(0)|int }}%)</span>{% if fsc.get('none', 0) > 0 %}, {% endif %}{% endif %}
        {% if fsc.get('none', 0) > 0 %}<span style="color: #6c757d;">{{ fsc.none }} None ({{ (fsc.none / fsc_total * 100)|round(0)|int }}%)</span>{% endif %}
    </li>
    {% endif %}
    {%- endif %}
    {%- if unique_aroi_count is not none and unique_contact_count is not none %}
    <li><strong><span title="Unique AROI operators and contact information for this network">Unique AROI Operators and Contact Information</span>:</strong> {{ unique_contact_count }}
        {%- if unique_aroi_contact_html %}, {{ unique_aroi_contact_html|safe }}{% endif -%}
    </li>
    {%- endif %}
    {#- AROI with merged validation badge (only show if has AROI data) -#}
    {%- set has_aroi_domain = aroi_domain and aroi_domain != 'none' and aroi_domain != '' -%}
    {%- set has_validation = contact_validation_status and contact_validation_status.has_aroi -%}
    {%- if has_aroi_domain and (contact_validation_status is none or has_validation) %}
    <li><strong><span title="Autonomous Relay Operator Identifier">AROI</span>:</strong> 
    {% if base_url and aroi_domain in validated_aroi_domains -%}
    <a href="{{ base_url }}/{{ aroi_domain|lower|escape }}/">{{ aroi_domain|escape }}</a>
    {% else -%}
    <a href="{{ page_ctx.path_prefix if page_ctx else '../../' }}contact/{{ contact_md5|escape }}/">{{ aroi_domain|escape }}</a>
    {% endif -%}
    {{- aroi_validation_badge(contact_validation_status) -}}
    </li>
    {%- elif has_validation %}
    {#- Show validation status even when AROI domain wasn't parsed -#}
    <li><strong><span title="Autonomous Relay Operator Identifier">AROI</span>:</strong>
        {{- aroi_validation_badge(contact_validation_status, show_count=true) -}}
    </li>
    {%- endif %}
    {%- if contact_md5 %}
    <li><strong>Contact:</strong> <a href="{{ page_ctx.path_prefix if page_ctx else '../../' }}contact/{{ contact_md5|escape }}/">{% if contact and contact.strip() %}{{ contact|escape }}{% else %}none{% endif %}</a></li>
    {%- endif %}
</ul>
{%- endmacro %}

{% macro aroi_validation_icon(fingerprint, aroi_domain, validated_fps, unauthorized_fps, misconfigured_fps) -%}
    {% if fingerprint in validated_fps -%}
        <span style="color: #28a745; margin-left: 4px;" title="AROI Validated: This relay's fingerprint has been cryptographically verified via the operator's AROI proof">‚úì</span>
    {% elif fingerprint in unauthorized_fps -%}
        <a href="#unauthorized-relays" style="color: #dc3545; margin-left: 4px; text-decoration: none;" title="Unauthorized Relay: This relay claims the domain but fingerprint is NOT in the AROI proof file">üö´</a>
    {% elif fingerprint in misconfigured_fps -%}
        <a href="#misconfigured-relays" style="color: #ffc107; margin-left: 4px; text-decoration: none;" title="AROI Misconfigured: Validation failed due to DNS/SSL/connection errors - see details below">‚ö†</a>
    {% elif aroi_domain and aroi_domain != 'none' -%}
        <span style="color: #dc3545; margin-left: 4px;" title="No AROI Validation: This relay has AROI configured but no validation data is available">‚úó</span>
    {% endif -%}
{%- endmacro %}

{# =============================================================================
   AROI VALIDATION BADGE MACRO (DRY - single macro with optional count display)
   Shows operator-level validation status badge.
   
   Operator statuses (cascade):
   - validated: At least 1 relay passes validation (green ‚úì)
   - unauthorized: 0 validated, but has unauthorized claims (red üö´)
   - misconfigured: 0 validated, 0 unauthorized, but has config issues (yellow ‚ö†)
   - not_configured: No AROI info at all (no badge shown)
   
   Set show_count=true to include relay counts (used when domain isn't displayed)
   ============================================================================= #}
{% macro aroi_validation_badge(contact_validation_status, show_count=false) -%}
{% if contact_validation_status -%}
    {%- set summary = contact_validation_status.validation_summary -%}
    {%- set status = contact_validation_status.validation_status -%}
    {% if status == 'validated' -%}
        <span style="color: #28a745; font-weight: bold;{% if not show_count %} margin-left: 5px;{% endif %}" title="{{ summary.validated_count }} relays validated{% if summary.unauthorized_count > 0 %}, {{ summary.unauthorized_count }} unauthorized claims{% endif %}{% if summary.misconfigured_count > 0 %}, {{ summary.misconfigured_count }} misconfigured{% endif %}">‚úì Validated{% if show_count %} ({{ summary.validated_count }} relays){% endif %}</span>
    {% elif status == 'unauthorized' -%}
        <a href="#unauthorized-relays" style="color: #dc3545; font-weight: bold;{% if not show_count %} margin-left: 5px;{% endif %} text-decoration: none;" title="{{ summary.unauthorized_count }} relays claiming this domain but NOT in proof file - see details below">üö´ Unauthorized{% if show_count %} ({{ summary.unauthorized_count }} relays){% endif %}</a>
    {% elif status == 'misconfigured' -%}
        <a href="#misconfigured-relays" style="color: #ffc107; font-weight: bold;{% if not show_count %} margin-left: 5px;{% endif %} text-decoration: none;" title="{{ summary.misconfigured_count }} relays with AROI config errors - see details below">‚ö† Misconfigured{% if show_count %} ({{ summary.misconfigured_count }} relays){% endif %}</a>
    {% elif status == 'incomplete' -%}
        <a href="#not_configured-relays" style="color: #6c757d; font-weight: bold;{% if not show_count %} margin-left: 5px;{% endif %} text-decoration: none;" title="{{ summary.incomplete_count }} relays with incomplete AROI configuration - see details below">Incomplete{% if show_count %} ({{ summary.incomplete_count }} relays){% endif %}</a>
    {# not_configured status shows no badge #}
    {% endif -%}
{% endif -%}
{%- endmacro %}

{# =============================================================================
   AROI SUB-BULLETS MACRO (DRY - shows category counts as sub-bullets)
   Used in Contact & Network Overview section
   ============================================================================= #}
{% macro aroi_sub_bullets(contact_validation_status) -%}
{% if contact_validation_status -%}
{% set summary = contact_validation_status.validation_summary -%}
{% set status = contact_validation_status.validation_status -%}
{# Only show sub-bullets for categories OTHER than the main status #}
{% set show_unauthorized = summary.unauthorized_count > 0 and status != 'unauthorized' -%}
{% set show_misconfigured = summary.misconfigured_count > 0 and status != 'misconfigured' -%}
{% set show_incomplete = summary.incomplete_count > 0 and status != 'incomplete' -%}
{% set show_not_configured = summary.not_configured_count > 0 -%}
{% if show_unauthorized or show_misconfigured or show_incomplete or show_not_configured -%}
<ul style="list-style-type: circle; padding-left: 20px; margin-top: 0; margin-bottom: 0;">
{% if show_unauthorized -%}
<li><a href="#unauthorized-relays" style="color: #dc3545; text-decoration: none;">üö´ Unauthorized: {{ summary.unauthorized_count }} relay{{ 's' if summary.unauthorized_count != 1 else '' }}</a></li>
{% endif -%}
{% if show_misconfigured -%}
<li><a href="#misconfigured-relays" style="color: #ffc107; text-decoration: none;">‚ö† Misconfigured: {{ summary.misconfigured_count }} relay{{ 's' if summary.misconfigured_count != 1 else '' }}</a></li>
{% endif -%}
{% if show_incomplete -%}
<li><a href="#not_configured-relays" style="color: #6c757d; text-decoration: none;">‚óã Incomplete: {{ summary.incomplete_count }} relay{{ 's' if summary.incomplete_count != 1 else '' }}</a></li>
{% endif -%}
{% if show_not_configured -%}
<li><a href="#not_configured-relays" style="color: #6c757d; text-decoration: none;">‚óã Not configured: {{ summary.not_configured_count }} relay{{ 's' if summary.not_configured_count != 1 else '' }}</a></li>
{% endif -%}
</ul>
{% endif -%}
{% endif -%}
{%- endmacro %}

{# =============================================================================
   AROI RELAY DETAIL BOX MACRO (DRY - reused by all section macros)
   Shows per-relay status details in a styled box below each table
   ============================================================================= #}
{% macro aroi_relay_detail_box(relays, box_type, page_ctx, aroi_validation_timestamp) -%}
{# box_type: 'misconfigured' | 'unauthorized' | 'not_configured' #}
{% if relays %}
    {# Style configuration based on box type #}
    {% if box_type == 'misconfigured' -%}
        {% set bg_color = '#fff3cd' -%}
        {% set border_color = '#ffc107' -%}
        {% set text_color = '#856404' -%}
        {% set icon = '‚ö†Ô∏è' -%}
        {% set title = 'MISCONFIGURED RELAY DETAILS' -%}
        {% set description = 'These relays have AROI configured but validation failed due to errors.' -%}
        {% set help_text = 'Fix: Check DNS records, renew SSL certificates, or verify server connectivity.' -%}
    {% elif box_type == 'unauthorized' -%}
        {% set bg_color = '#f8d7da' -%}
        {% set border_color = '#dc3545' -%}
        {% set text_color = '#721c24' -%}
        {% set icon = 'üö´' -%}
        {% set title = 'UNAUTHORIZED RELAY DETAILS' -%}
        {% set description = 'These relays claim this domain but their fingerprints are NOT in the AROI proof file. This could be someone falsely claiming your domain.' -%}
        {% set help_text = 'If this is YOUR relay: Add the fingerprint to your AROI proof file.' -%}
    {% else -%}
        {% set bg_color = '#e9ecef' -%}
        {% set border_color = '#6c757d' -%}
        {% set text_color = '#495057' -%}
        {% set icon = '‚óã' -%}
        {% set title = 'NOT CONFIGURED RELAY DETAILS' -%}
        {% set description = 'These relays have no AROI configuration or incomplete setup.' -%}
        {% set help_text = 'To add AROI: Set contact info with ciissversion:2, proof:dns-rsa or proof:uri-rsa, and url:yourdomain.com' -%}
    {% endif -%}
    
<div style="margin-top: 15px; padding: 15px; background-color: {{ bg_color }}; border-left: 4px solid {{ border_color }}; border-radius: 4px;">
    <h5 style="margin-top: 0; margin-bottom: 10px; color: {{ text_color }}; font-size: 14px;">
        <strong>{{ icon }} {{ title }}</strong>
    </h5>
    
    <p style="margin-bottom: 10px; font-size: 13px; color: {{ text_color }};">
        {{ description }}
    </p>
    
    {% if aroi_validation_timestamp %}
    <p style="margin-bottom: 10px; font-size: 12px; color: #666; font-style: italic;">
        Validation data last updated: {{ aroi_validation_timestamp }}
    </p>
    {% endif %}
    
    <ul style="list-style-type: none; padding-left: 0; margin-bottom: 10px;">
        {% for relay_info in relays %}
        <li style="margin-bottom: 6px; padding: 8px; background-color: #fff; border-radius: 3px; font-size: 13px; border: 1px solid {{ border_color }}40;">
            <strong><a href="{{ page_ctx.path_prefix }}relay/{{ relay_info.fingerprint }}/">{{ relay_info.nickname|escape }}</a></strong>
            <span style="color: #666;">‚Ä¢</span>
            {% if relay_info.error -%}
                <span style="color: #dc3545;">{{ relay_info.error|escape }}</span>
            {% elif relay_info.missing -%}
                <span style="color: #856404;">{{ relay_info.missing|escape }}</span>
            {% endif -%}
            {% if relay_info.proof_type and relay_info.proof_type != 'unknown' %}
                <span style="color: #666;">‚Ä¢ Proof: {{ relay_info.proof_type }}</span>
            {% endif %}
            <span style="color: #666;">‚Ä¢ FP: <code style="font-size: 11px;">{{ relay_info.fingerprint }}</code></span>
        </li>
        {% endfor %}
    </ul>
    
    <p style="font-size: 12px; color: {{ text_color }}; margin-bottom: 0;">
        üí° <strong>{{ help_text }}</strong>
        <br>üìñ See the <a href="https://nusenu.github.io/ContactInfo-Information-Sharing-Specification/" target="_blank" rel="noopener" style="color: {{ text_color }}; text-decoration: underline;">AROI Specification</a> for guidance.
    </p>
</div>
{% endif %}
{%- endmacro %}

{# =============================================================================
   AROI SECTION HEADER MACRO (DRY - reused by all section macros)
   ============================================================================= #}
{% macro aroi_section_header(title, count, style_type) -%}
{# style_type: 'validated' | 'misconfigured' | 'unauthorized' | 'not_configured' #}
{% if style_type == 'validated' -%}
    {% set border_style = '3px solid #28a745' -%}
    {% set icon = '‚úì' -%}
    {% set color = '#28a745' -%}
{% elif style_type == 'misconfigured' -%}
    {% set border_style = '3px solid #ffc107' -%}
    {% set icon = '‚ö†' -%}
    {% set color = '#ffc107' -%}
{% elif style_type == 'unauthorized' -%}
    {% set border_style = '3px dashed #dc3545' -%}
    {% set icon = 'üö´' -%}
    {% set color = '#dc3545' -%}
{% else -%}
    {% set border_style = '3px solid #6c757d' -%}
    {% set icon = '‚óã' -%}
    {% set color = '#6c757d' -%}
{% endif -%}
<div id="{{ style_type }}-relays" style="margin-top: 30px; padding: 15px 0; border-top: {{ border_style }};">
    <h3 style="margin: 0 0 15px 0; font-size: 16px;">
        <a href="#{{ style_type }}-relays" style="color: {{ color }}; text-decoration: none;">{{ icon }} {{ title }} ({{ count }})</a>
    </h3>
{%- endmacro %}

{# =============================================================================
   LEGACY AROI_VALIDATION_ISSUES_SECTION MACRO 
   (Kept for backwards compatibility - calls are replaced with new section macros)
   ============================================================================= #}
{% macro aroi_validation_issues_section(contact_validation_status, aroi_validation_timestamp, page_ctx) -%}
{# This macro is deprecated - issues are now shown in per-category sections #}
{# Kept empty for backwards compatibility during transition #}
{%- endmacro %} 