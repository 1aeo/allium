{# AROI Leaderboard Macros - Eliminate Template Code Duplication #}

{# Champion Badge Macro - Eliminate 10x duplicate champion badge blocks #}
{% macro champion_badge(category_key, leaderboard_data, title, emoji, panel_class="panel-warning", champion_class="", path_prefix="", use_bits=false) %}
    <div class="col-md-3 col-sm-6 aroi-champion-badge">
        <div class="panel {{ panel_class }}">
            <div class="panel-body text-center {{ champion_class }}">
                <h3 class="aroi-header-spacing" title="Elite champion in {{ title.lower() }} category"><a href="#{{ category_key }}" style="color: inherit; text-decoration: none;">{{ emoji }} {{ title }}</a></h3>
                {% if leaderboard_data %}
                    {% set champion = leaderboard_data[0] %}
                    <h4><strong><a href="{{ path_prefix }}contact/{{ champion.contact_hash }}/" title="Contact: {{ champion.contact_info_escaped }}" class="aroi-underline-link">{{ champion.display_name|escape }}</a></strong></h4>
                    <p>
                        {% if category_key == "bandwidth" %}
                            <span title="Total observed bandwidth capacity in {% if use_bits %}{{ champion.bandwidth_unit }} (bits per second){% else %}{{ champion.bandwidth_unit }} (bytes per second){% endif %}">{{ champion.total_bandwidth }} {{ champion.bandwidth_unit }}</span>
                        {% elif category_key == "consensus_weight" %}
                            <span title="Network consensus weight controlling Tor routing decisions">{{ champion.total_consensus_weight_pct }} authority</span>
                        {% elif category_key == "exit_authority" %}
                            <span title="Control over internet exit traffic routing">{{ champion.exit_consensus_weight_pct }} exit authority</span>
                        {% elif category_key == "guard_authority" %}
                            <span title="Control over network entry traffic routing">{{ champion.guard_consensus_weight_pct }} guard authority</span>
                        {% elif category_key == "exit_operators" %}
                            <span title="Active exit relays providing critical internet access points">{{ champion.exit_count }} exit relays</span>
                        {% elif category_key == "guard_operators" %}
                            <span title="Active guard relays serving as critical network entry points">{{ champion.guard_count }} guard relays</span>
                        {% elif category_key == "most_diverse" %}
                            <span title="Diversity Score: Geographic (countries × 2.0) + Platform (OS types × 1.5) + Network (unique ASNs × 1.0)">{{ champion.diversity_score }} diversity</span>
                        {% elif category_key == "platform_diversity" %}
                            <span title="Relays promoting OS diversity beyond Linux dominance">{{ champion.non_linux_count }} non-Linux relays</span>
                        {% elif category_key == "non_eu_leaders" %}
                            <span title="Relays expanding Tor geographic reach beyond European Union">{{ champion.non_eu_count }} non-EU relays</span>
                        {% elif category_key == "frontier_builders" %}
                            <span title="Countries with strategic importance but underrepresented in Tor network">{{ champion.rare_country_count }} rare countries</span>
                        {% elif category_key == "network_veterans" %}
                            <span title="Online and serving traffic since first day">{{ champion.veteran_days }} days</span>
                        {% elif category_key == "reliability_masters" %}
                            <span title="6-month average uptime reliability score (25+ relays)">{{ champion.reliability_score }} reliability</span>
                        {% elif category_key == "legacy_titans" %}
                            <span title="5-year average uptime reliability score (25+ relays)">{{ champion.reliability_score }} legacy score</span>
                        {% elif category_key == "bandwidth_masters" %}
                            <span title="6-month average bandwidth served performance (25+ relays)">{{ champion.bandwidth_details_short }}</span>
                        {% elif category_key == "bandwidth_legends" %}
                            <span title="5-year average bandwidth served performance (25+ relays)">{{ champion.bandwidth_details_short }}</span>
                        {% elif category_key == "ipv4_leaders" %}
                            <span title="Number of unique IPv4 addresses across relay infrastructure">{{ champion.unique_ipv4_count }} unique IPv4</span>
                        {% elif category_key == "ipv6_leaders" %}
                            <span title="Number of unique IPv6 addresses across relay infrastructure">{{ champion.unique_ipv6_count }} unique IPv6</span>
                        {% endif %}
                    </p>
                    <small>
                        {% if category_key == "exit_authority" %}
                            <span title="Complete relay infrastructure operated by exit authority champion">{{ champion.exit_count }} exit relays</span>
                        {% elif category_key == "guard_authority" %}
                            <span title="Complete relay infrastructure operated by guard authority champion">{{ champion.guard_count }} guard relays</span>
                        {% elif category_key == "most_diverse" %}
                            <span title="Geographic distribution of relay operations">{{ champion.country_count }} countries</span>
                        {% else %}
                            <span title="Complete relay infrastructure operated by champion">{{ champion.total_relays }} total relays</span>
                        {% endif %}
                    </small>
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}

{# Top 3 Table Macro - Eliminate 10x duplicate top 3 table blocks #}
{% macro top3_table(title, emoji, leaderboard_data, achievements, performance_type, page_ctx, use_bits=false) %}
    <div class="aroi-subsection">
        <h4 title="Top 3 performers in {{ title.lower() }} category"><a href="#{{ performance_type }}" style="color: inherit; text-decoration: none;">{{ emoji }} {{ title }}</a></h4>
        {% if leaderboard_data %}
        <div class="table-responsive">
            <table class="table table-striped aroi-top3-table">
                <thead>
                    <tr>
                        <th title="Relay operator with podium placement">Operator</th>
                        <th title="Recognition level earned for performance in this category">Achievement</th>
                        <th title="Detailed performance metrics and operational statistics">Performance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in leaderboard_data[:3] %}
                    <tr>
                        <td>
                            <strong>
                                {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% elif entry.rank == 3 %}🥉{% endif %}
                                <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info_escaped }}" class="aroi-underline-link">{{ entry.display_name|escape }}</a>
                            </strong>
                        </td>
                        <td>
                            {% if performance_type == "non_eu_leaders" %}
                                <span title="Geographic achievement expanding Tor reach beyond European Union">{{ entry.geographic_achievement }}</span>
                            {% elif performance_type == "most_diverse" and entry.diversity_master_title %}
                                <span title="Dynamic achievement title for diversity mastery">{{ entry.diversity_master_title }}</span>
                            {% elif performance_type == "platform_diversity" and entry.platform_hero_title %}
                                <span title="Dynamic achievement title for platform diversity leadership">{{ entry.platform_hero_title }}</span>
                            {% elif performance_type == "frontier_builders" and entry.frontier_achievement_title %}
                                <span title="Dynamic achievement title for frontier expansion">{{ entry.frontier_achievement_title }}</span>
                            {% elif performance_type == "ipv4_leaders" and entry.ipv4_achievement_title %}
                                <span title="Dynamic achievement title for IPv4 infrastructure leadership">{{ entry.ipv4_achievement_title }}</span>
                            {% elif performance_type == "ipv6_leaders" and entry.ipv6_achievement_title %}
                                <span title="Dynamic achievement title for IPv6 infrastructure leadership">{{ entry.ipv6_achievement_title }}</span>
                            {% else %}
                                <span title="Achievement level for rank {{ entry.rank }} in {{ performance_type.replace('_', ' ').title() }} category">
                                {% if entry.rank == 1 %}{{ achievements[0] }}
                                {% elif entry.rank == 2 %}{{ achievements[1] }}
                                {% elif entry.rank == 3 %}{{ achievements[2] }}
                                {% endif %}
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if performance_type == "bandwidth" %}
                                <span title="Total observed bandwidth capacity in {% if use_bits %}{{ entry.bandwidth_unit }} (bits per second){% else %}{{ entry.bandwidth_unit }} (bytes per second){% endif %} across all relays">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }} across {{ entry.total_relays }} relays</span>
                            {% elif performance_type == "consensus_weight" %}
                                <span title="Percentage of total Tor network consensus weight controlling routing decisions">{{ entry.total_consensus_weight_pct }} network authority</span>
                            {% elif performance_type == "exit_authority" %}
                                <span title="Percentage of exit consensus weight controlling internet access points">{{ entry.exit_consensus_weight_pct }} exit authority</span>
                            {% elif performance_type == "guard_authority" %}
                                <span title="Percentage of guard consensus weight controlling network entry points">{{ entry.guard_consensus_weight_pct }} guard authority</span>
                            {% elif performance_type == "exit_operators" %}
                                <span title="Number of active exit relays providing critical internet access points">{{ entry.exit_count }} active exit relays</span>
                            {% elif performance_type == "guard_operators" %}
                                <span title="Number of active guard relays serving as critical network entry points">{{ entry.guard_count }} active guard relays</span>
                            {% elif performance_type == "most_diverse" %}
                                <span title="Geographic distribution and diversity score calculation">{{ entry.country_count }} countries, <span title="Diversity Score: Geographic (countries × 2.0) + Platform (OS types × 1.5) + Network (unique ASNs × 1.0)">{{ entry.diversity_score }} diversity</span></span>
                            {% elif performance_type == "platform_diversity" %}
                                <span title="Non-Linux relays promoting OS diversity and total bandwidth capacity">{{ entry.non_linux_count }} non-Linux relays, {{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</span>
                            {% elif performance_type == "non_eu_leaders" %}
                                <span title="Non-EU relays expanding Tor network beyond European Union concentration. This is the primary ranking metric for Global Expansion Leaders.">{{ entry.non_eu_count }} non-EU relays in {{ entry.country_count }} countries</span>
                            {% elif performance_type == "frontier_builders" %}
                                <span title="{{ entry.rare_country_tooltip }}">{{ entry.relays_in_rare_countries }} relays in {{ entry.rare_country_count }} rare countries</span>
                            {% elif performance_type == "network_veterans" %}
                                <span title="{{ entry.veteran_tooltip }}">{{ entry.veteran_days }} days * {{ entry.total_relays }} relays</span>
                            {% elif performance_type == "reliability_masters" %}
                                <span title="{{ entry.reliability_tooltip }}">{{ entry.reliability_average }} avg</span>
                            {% elif performance_type == "legacy_titans" %}
                                <span title="{{ entry.reliability_tooltip }}">{{ entry.reliability_average }} avg</span>
                            {% elif performance_type == "bandwidth_masters" %}
                                <span title="{{ entry.bandwidth_tooltip }}">{{ entry.bandwidth_details_short }}</span>
                            {% elif performance_type == "bandwidth_legends" %}
                                <span title="{{ entry.bandwidth_tooltip }}">{{ entry.bandwidth_details_short }}</span>
                            {% elif performance_type == "ipv4_leaders" %}
                                <span title="{{ entry.ip_address_tooltip }}">{{ entry.unique_ipv4_count }} unique IPv4 addresses</span>
                            {% elif performance_type == "ipv6_leaders" %}
                                <span title="{{ entry.ip_address_tooltip }}">{{ entry.unique_ipv6_count }} unique IPv6 addresses</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
{% endmacro %}

{# Ranking Table Components - Eliminate massive duplication in ranking tables #}

{# Rank Badge Macro - Handles rank display with proper medal styling (used ~50 times) #}
{% macro rank_badge(rank) %}
    {% if rank <= 3 %}
        <span class="badge {% if rank == 1 %}aroi-rank-gold{% elif rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}" title="{% if rank == 1 %}Gold medal - Champion{% elif rank == 2 %}Silver medal - Runner-up{% else %}Bronze medal - Third place{% endif %} position">
            {% if rank == 1 %}🥇{% elif rank == 2 %}🥈{% else %}🥉{% endif %} {{ rank }}
        </span>
    {% else %}
        <span class="badge badge-default" title="Rank {{ rank }} in this category">{{ rank }}</span>
    {% endif %}
{% endmacro %}

{# Operator Link Macro - Handles operator name/domain links with proper styling (used ~50 times) #}
{% macro operator_link(entry, page_ctx, include_title=true, strong=true) %}
    <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" {% if include_title %}title="Contact: {{ entry.contact_info_escaped }}"{% endif %} class="aroi-underline-link">
        {% if strong %}<strong>{% endif %}
        {{ entry.display_name|escape }}
        {% if strong %}</strong>{% endif %}
    </a>
{% endmacro %}

{# Generic Ranking Table Macro - For the loop-based tables with standardized columns #}
{% macro generic_ranking_table(category_key, category_name, category_data, emoji, page_ctx, use_bits=false) %}
    <section id="{{ category_key }}" class="aroi-section">
        <h3 title="Operators ranked by 
        {%- if category_key == 'most_diverse' -%}combined geographic, platform, and network diversity scores
        {%- elif category_key == 'platform_diversity' -%}number of non-Linux relays promoting OS diversity
        {%- elif category_key == 'non_eu_leaders' -%}number of relays operated outside the European Union
        {%- elif category_key == 'frontier_builders' -%}rare country scores from strategically important countries
        {%- elif category_key == 'network_veterans' -%}veteran scores calculated as (earliest relay start date × total relay count). Formula: veteran_score = days_since_first_relay × total_relays. Recognizes operators who have been contributing to the Tor network for the longest time with sustained relay operations
        {%- elif category_key == 'reliability_masters' -%}6-month average uptime reliability scores from Onionoo API data for operators with 25+ relays. Formula: reliability_score = average_6_month_uptime. Measures operational excellence and network reliability over recent 6-month period using simple average uptime percentages
        {%- elif category_key == 'legacy_titans' -%}5-year average uptime reliability scores from Onionoo API data for operators with 25+ relays. Formula: reliability_score = average_5_year_uptime. Measures long-term operational stability and reliability over 5-year historical period using simple average uptime percentages
        {%- elif category_key == 'ipv4_leaders' -%}quantity of unique IPv4 addresses per operator across their relay infrastructure. Measures IPv4 address diversity and network distribution capabilities
        {%- elif category_key == 'ipv6_leaders' -%}quantity of unique IPv6 addresses per operator across their relay infrastructure. Measures IPv6 adoption and modern network infrastructure capabilities
        {%- endif -%}">{% if emoji %}{{ emoji }} {% endif %}{{ category_name }}</h3>
        {% if category_data %}
        <div class="table-responsive">
            <table class="table table-striped table-condensed aroi-rankings-table {% if category_key == 'non_eu_leaders' %}aroi-geographic-table{% elif category_key == 'frontier_builders' %}aroi-frontier-table{% elif category_key == 'platform_diversity' %}aroi-platform-table{% else %}aroi-category-table{% endif %}">
                <thead>
                    <tr>
                        <th title="Position in {{ category_name.lower() }} leaderboard">Rank</th>
                        <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                        {% if category_key != 'platform_diversity' and category_key != 'non_eu_leaders' and category_key != 'frontier_builders' %}
                        <th title="{% if category_key == 'network_veterans' %}Total relay count: number of relays currently operated. For veterans, higher relay counts with early start dates result in higher veteran scores{% elif category_key == 'reliability_masters' %}Total relay count: number of relays contributing to reliability calculations. More relays provide larger sample size for uptime measurements{% elif category_key == 'legacy_titans' %}Total relay count: number of relays contributing to long-term reliability scores. Sustained relay operations over 5 years demonstrate commitment{% else %}Total number of relays operated by this operator{% endif %}">Relays</th>
                        {% endif %}
                        <th title="Primary ranking metric for 
                        {%- if category_key == 'most_diverse' -%}diversity score calculation
                        {%- elif category_key == 'platform_diversity' -%}non-Linux relay count
                        {%- elif category_key == 'non_eu_leaders' -%}non-EU relay count with percentage
                        {%- elif category_key == 'frontier_builders' -%}rare country relay count
                        {%- elif category_key == 'network_veterans' -%}veteran score calculation: days since first relay start date × total relay count. Higher scores indicate longer network service with more relays
                        {%- elif category_key == 'reliability_masters' -%}6-month reliability score: simple average uptime percentage from Onionoo API (25+ relays). Measures recent operational excellence and network reliability
                        {%- elif category_key == 'legacy_titans' -%}5-year reliability score: simple average uptime percentage from Onionoo API (25+ relays). Measures long-term operational stability and historical reliability
                                            {%- endif -%}">{% if category_key == 'platform_diversity' %}Non Linux Relays{% elif category_key == 'non_eu_leaders' %}Non-EU Relays{% elif category_key == 'frontier_builders' %}Rare Relays{% elif category_key == 'reliability_masters' %}Reliability Score{% elif category_key == 'legacy_titans' %}Legacy Score{% else %}Key Metric{% endif %}</th>
                        <th title="Total observed bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Bandwidth Capacity</th>
                        {% if category_key != 'platform_diversity' %}
                        <th title="{% if category_key == 'network_veterans' %}Geographic distribution: number of countries with relay operations. Geographic diversity demonstrates network resilience and reduces single-point-of-failure risks{% elif category_key == 'reliability_masters' %}Geographic distribution: number of countries with relay operations. Geographic diversity for reliability indicates distributed operational infrastructure{% elif category_key == 'legacy_titans' %}Geographic distribution: number of countries with relay operations. Geographic diversity for long-term operators shows sustained international presence{% else %}Number of countries with relay operations{% endif %}">Countries</th>
                        {% endif %}
                        {% if category_key != 'frontier_builders' and category_key != 'non_eu_leaders' and category_key != 'platform_diversity' %}
                        <th title="{% if category_key == 'network_veterans' %}Platform diversity: number of different operating systems used. Diversified platforms reduce monoculture risks and demonstrate technical sophistication{% elif category_key == 'reliability_masters' %}Platform diversity: number of different operating systems used. Platform diversity for reliable operators indicates varied technical infrastructure{% elif category_key == 'legacy_titans' %}Platform diversity: number of different operating systems used. Platform diversity for long-term operators shows sustained technical variety{% else %}Number of different operating systems used{% endif %}">Platforms</th>
                        {% endif %}
                        {% if category_key == 'most_diverse' %}
                        <th title="Number of unique Autonomous Systems (ASNs) used for network diversity">Unique AS</th>
                        {% elif category_key != 'reliability_masters' and category_key != 'legacy_titans' %}
                        <th title="Primary operational focus or unique contribution to Tor network">Specialization</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for entry in category_data[:25] %}
                    <tr>
                        <td>{{ rank_badge(entry.rank) }}</td>
                        <td>{{ operator_link(entry, page_ctx) }}</td>
                        {% if category_key != 'platform_diversity' and category_key != 'non_eu_leaders' and category_key != 'frontier_builders' %}
                                            <td title="Active relays currently contributing to Tor network">{{ entry.total_relays }}</td>
                        {% endif %}
                        <td>
                            <strong>
                            {% if category_key == 'most_diverse' %}<span title="{{ entry.diversity_breakdown_tooltip if entry.diversity_breakdown_tooltip else 'Diversity Score: Geographic (countries × 2.0) + Platform (OS types × 1.5) + Network (unique ASNs × 1.0)' }}">{{ entry.diversity_score }}</span>
                            {% elif category_key == 'platform_diversity' %}<span title="Relays promoting operating system diversity beyond Linux dominance">{{ entry.non_linux_count }}</span>
                            {% elif category_key == 'non_eu_leaders' %}<span title="Relays expanding Tor geographic reach beyond European Union concentration">{{ entry.non_eu_count_with_percentage }}</span>
                            {% elif category_key == 'frontier_builders' %}<span title="Relays in countries with strategic importance but underrepresented in Tor network">{{ entry.relays_in_rare_countries }}</span>
                            {% elif category_key == 'network_veterans' %}<span title="Veteran Score Calculation: {{ entry.veteran_tooltip if entry.veteran_tooltip else 'Days since first relay started × total relay count. Higher scores indicate longer continuous network service with more relays operated' }}">{{ entry.veteran_score }}</span>
                            {% elif category_key == 'reliability_masters' %}
                                <span title="{{ entry.reliability_tooltip }}">{{ entry.reliability_average }} avg</span>
                            {% elif category_key == 'legacy_titans' %}
                                <span title="{{ entry.reliability_tooltip }}">{{ entry.reliability_average }} avg</span>
                            {% endif %}
                            </strong>
                        </td>
                        <td title="Observed bandwidth capacity in {% if use_bits %}{{ entry.bandwidth_unit }} (bits per second){% else %}{{ entry.bandwidth_unit }} (bytes per second){% endif %}">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</td>
                        {% if category_key != 'platform_diversity' %}
                        <td title="Geographic distribution of relay operations">{{ entry.country_count }}</td>
                        {% endif %}
                        {% if category_key != 'frontier_builders' and category_key != 'non_eu_leaders' and category_key != 'platform_diversity' %}
                        <td title="Operating system diversity across relay infrastructure">{{ entry.platform_count }}</td>
                        {% endif %}
                        {% if category_key == 'most_diverse' %}
                        <td title="Number of unique Autonomous Systems providing network distribution">{{ entry.unique_as_count }}</td>
                        {% elif category_key != 'reliability_masters' and category_key != 'legacy_titans' %}
                        <td>
                            {% if category_key == 'platform_diversity' %}<span title="{{ entry.platform_breakdown_tooltip if entry.platform_breakdown_tooltip else 'Promoting operating system diversity beyond Linux dominance' }}">{{ entry.platform_breakdown_details if entry.platform_breakdown_details else 'OS diversity' }}</span>
                            {% elif category_key == 'non_eu_leaders' %}<span title="{{ entry.geographic_breakdown_tooltip }}">{{ entry.geographic_breakdown_details if entry.geographic_breakdown_details else 'Global expansion' }}</span>
                            {% elif category_key == 'frontier_builders' %}<span title="{{ entry.rare_country_tooltip }}">{{ entry.rare_country_details if entry.rare_country_details else 'Frontier presence' }}</span>
                            {% elif category_key == 'network_veterans' %}<span title="Network longevity specialization: {{ entry.veteran_tooltip if entry.veteran_tooltip else 'This operator has been contributing to the Tor network for an extended period, demonstrating long-term commitment and operational stability' }}">{{ entry.veteran_details_short if entry.veteran_details_short else 'Network longevity' }}</span>
                            {% elif category_key == 'ipv4_leaders' %}<span title="{{ entry.ip_address_tooltip }}">{{ entry.ip_address_details if entry.ip_address_details else 'IPv4 infrastructure' }}</span>
                            {% elif category_key == 'ipv6_leaders' %}<span title="{{ entry.ip_address_tooltip }}">{{ entry.ip_address_details if entry.ip_address_details else 'IPv6 infrastructure' }}</span>
                            {% endif %}
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <p>No data available for {{ category_name }}.</p>
        </div>
        {% endif %}
    </section>
{% endmacro %}

{# Paginated Ranking Table Macro - For tables with top 100 results split into 4 pages of 25 #}
{% macro paginated_ranking_table(category_key, title, emoji, leaderboard_data, headers, page_ctx, use_bits=false) %}
    <section id="{{ category_key }}" class="aroi-section">
        <h3 title="{{ title }}">{{ emoji }} {{ title }}</h3>
        {% if leaderboard_data %}
        
        <!-- Pagination Navigation -->
        <div class="pagination-nav">
            <a href="#{{ category_key }}-1-25">1-25</a>
            <a href="#{{ category_key }}-26-50">26-50</a>
            <a href="#{{ category_key }}-51-75">51-75</a>
            <a href="#{{ category_key }}-76-100">76-100</a>
        </div>
        
        <!-- Page 1: Ranks 1-25 -->
        <div id="{{ category_key }}-1-25" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 1-25</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[:25] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 2: Ranks 26-50 -->
        <div id="{{ category_key }}-26-50" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 26-50</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[25:50] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 3: Ranks 51-75 -->
        <div id="{{ category_key }}-51-75" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 51-75</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[50:75] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 4: Ranks 76-100 -->
        <div id="{{ category_key }}-76-100" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 76-100</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[75:100] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        {% else %}
        <div class="alert alert-warning">
            <p>No {{ title.lower() }} data available.</p>
        </div>
        {% endif %}
    </section>
{% endmacro %}

{# Top 5 Paginated Ranking Table Macro - For tables with top 25 results split into 5 pages of 5 #}
{% macro top5_paginated_ranking_table(category_key, title, emoji, leaderboard_data, headers, page_ctx, use_bits=false) %}
    <section id="{{ category_key }}" class="aroi-section">
        <h3 title="{{ title }}">{{ emoji }} {{ title }} - Top 25</h3>
        {% if leaderboard_data %}
        
        <!-- Pagination Navigation -->
        <div class="pagination-nav">
            <a href="#{{ category_key }}-1-5">1-5</a>
            <a href="#{{ category_key }}-6-10">6-10</a>
            <a href="#{{ category_key }}-11-15">11-15</a>
            <a href="#{{ category_key }}-16-20">16-20</a>
            <a href="#{{ category_key }}-21-25">21-25</a>
        </div>
        
        <!-- Page 1: Ranks 1-5 -->
        <div id="{{ category_key }}-1-5" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 1-5</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[:5] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 2: Ranks 6-10 -->
        <div id="{{ category_key }}-6-10" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 6-10</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[5:10] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 3: Ranks 11-15 -->
        <div id="{{ category_key }}-11-15" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 11-15</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[10:15] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 4: Ranks 16-20 -->
        <div id="{{ category_key }}-16-20" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 16-20</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[15:20] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page 5: Ranks 21-25 -->
        <div id="{{ category_key }}-21-25" class="pagination-section">
            <h4>{{ emoji }} {{ title }} - Ranks 21-25</h4>
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                    <thead>
                        <tr>{{ headers|safe }}</tr>
                    </thead>
                    <tbody>
                        {% for entry in leaderboard_data[20:25] %}
                            {{ caller(entry) }}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        {% else %}
        <div class="alert alert-warning">
            <p>No {{ title.lower() }} data available.</p>
        </div>
        {% endif %}
    </section>
{% endmacro %}

{# Bandwidth Table Headers Macro - To avoid repetition across pagination sections #}
{% macro bandwidth_table_headers(use_bits=false) %}
    <th title="Position in bandwidth leaderboard based on total observed bandwidth capacity">Rank</th>
    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
    <th title="Total number of relays operated with measured vs unmeasured breakdown">Relays</th>
    <th title="Total observed bandwidth capacity contributed to Tor network in {% if use_bits %}bits per second (Mbit/s, Gbit/s, etc.){% else %}bytes per second (MB/s, GB/s, etc.){% endif %}">Bandwidth Capacity</th>
    <th title="Percentage of total Tor network consensus weight controlling routing decisions">Consensus Weight</th>
    <th title="Number of guard, middle, and exit relays providing specialized services">Guard/Middle/Exit Count</th>
    <th title="Geographic distribution of relay operations across countries">Countries</th>
    <th title="Operating system diversity across relay infrastructure">Platforms</th>
{% endmacro %}

{# Complete Bandwidth Table Macro - Includes both headers and body to eliminate all duplication #}
{% macro bandwidth_table_complete(bandwidth_data, use_bits, page_ctx) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
            <thead>
                <tr>
                    {{ bandwidth_table_headers(use_bits) }}
                </tr>
            </thead>
            <tbody>
                {% for entry in bandwidth_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td>
                        <span title="Total: {{ entry.total_relays }} | Measured: {{ entry.measured_count }}">
                            {{ entry.total_relays }}
                            {% if entry.measured_count > 0 %}
                                <small class="text-muted">({{ entry.measured_count }} measured)</small>
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <span class="text-nowrap"><strong title="Observed bandwidth capacity in {% if use_bits %}{{ entry.bandwidth_unit }} (bits per second){% else %}{{ entry.bandwidth_unit }} (bytes per second){% endif %}">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</strong></span>
                    </td>
                    <td>
                        <span class="text-nowrap" title="Percentage of total network authority for routing decisions">{{ entry.total_consensus_weight_pct }}</span>
                    </td>
                    <td>
                        <span title="Guard: {{ entry.guard_count }} | Exit: {{ entry.exit_count }} | Middle: {{ entry.middle_count }}">
                            🛡️{{ entry.guard_count }} / 🌐{{ entry.middle_count }} / 🚪{{ entry.exit_count }}
                        </span>
                    </td>
                    <td>
                        <span title="Countries: {{ entry.countries|join(', ') }}">
                            {{ entry.country_count }}
                            {% if entry.countries|length > 0 %}
                                <small class="text-muted">({{ entry.countries[:6]|join(', ') }}{% if entry.countries|length > 6 %}...{% endif %})</small>
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <span title="Platforms: {{ entry.platforms|join(', ') }}">
                            {{ entry.platform_count }}
                            {% if entry.non_linux_count > 0 %}
                                <small class="text-success" title="Relays promoting OS diversity beyond Linux dominance">({{ entry.non_linux_count }} non-Linux)</small>
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}

{# Consensus Weight Table Complete Macro - Network Heavyweight Rankings #}
{% macro consensus_weight_table_complete(consensus_data, use_bits, page_ctx) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
            <thead>
                <tr>
                    <th title="Position in network authority leaderboard based on consensus weight">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    <th title="Total relay count contributing to consensus weight calculation">Relays</th>
                    <th title="Percentage of total Tor network consensus weight controlled">Network Heavyweight</th>
                    <th title="Total observed bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Bandwidth Capacity</th>
                    <th title="Number of guard, middle, and exit relays providing specialized services">Guard/Middle/Exit Count</th>
                    <th title="Number of countries with relay presence">Countries</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in consensus_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td title="Active relays currently contributing to Tor network">{{ entry.total_relays }}</td>
                    <td>
                        <span class="text-nowrap"><strong title="Network consensus weight controlling Tor routing decisions">{{ entry.total_consensus_weight_pct }}</strong></span>
                    </td>
                    <td>
                        <span class="text-nowrap" title="Observed bandwidth capacity in {% if use_bits %}{{ entry.bandwidth_unit }} (bits per second){% else %}{{ entry.bandwidth_unit }} (bytes per second){% endif %}">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</span>
                    </td>
                    <td>
                        <span title="Guard: {{ entry.guard_count }} | Exit: {{ entry.exit_count }} | Middle: {{ entry.middle_count }}">
                            🛡️{{ entry.guard_count }} / 🌐{{ entry.middle_count }} / 🚪{{ entry.exit_count }}
                        </span>
                    </td>
                    <td title="Number of countries with relay operations">{{ entry.country_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}

{# Exit Authority Table Complete Macro - Exit Authorities #}
{% macro exit_authority_table_complete(exit_authority_data, use_bits, page_ctx) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
            <thead>
                <tr>
                    <th title="Position in exit authority leaderboard based on exit consensus weight">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    <th title="Number of relays providing exit services to internet">Exit Relays</th>
                    <th title="Percentage of exit consensus weight controlling internet access">Exit Authority</th>
                    <th title="Overall network consensus weight across all relay types">Total Authority</th>
                    <th title="Exit relay bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Exit Bandwidth Capacity</th>
                    <th title="Number of countries with relay operations">Countries</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in exit_authority_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td title="Active exit relays providing internet access">{{ entry.exit_count }}</td>
                    <td>
                        <span class="text-nowrap"><strong title="Control over internet exit traffic routing">{{ entry.exit_consensus_weight_pct }}</strong></span>
                    </td>
                    <td>
                        <span class="text-nowrap" title="Total network consensus weight across all relay types">{{ entry.total_consensus_weight_pct }}</span>
                    </td>
                    <td>
                        <span class="text-nowrap" title="Exit relay bandwidth capacity in {% if use_bits %}{{ entry.exit_bandwidth_unit }} (bits per second){% else %}{{ entry.exit_bandwidth_unit }} (bytes per second){% endif %}">{{ entry.exit_bandwidth }} {{ entry.exit_bandwidth_unit }}</span>
                    </td>
                    <td title="Geographic distribution of relay operations">{{ entry.country_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}

{# Guard Authority Table Complete Macro - Guard Authorities #}
{% macro guard_authority_table_complete(guard_authority_data, use_bits, page_ctx) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
            <thead>
                <tr>
                    <th title="Position in guard authority leaderboard based on guard consensus weight">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    <th title="Number of relays providing guard services to network entry">Guard Relays</th>
                    <th title="Percentage of guard consensus weight controlling network entry">Guard Authority</th>
                    <th title="Overall network consensus weight across all relay types">Total Authority</th>
                    <th title="Guard relay bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Guard Bandwidth Capacity</th>
                    <th title="Number of countries with relay operations">Countries</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in guard_authority_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td title="Active guard relays providing network entry">{{ entry.guard_count }}</td>
                    <td>
                        <span class="text-nowrap"><strong title="Control over network entry traffic routing">{{ entry.guard_consensus_weight_pct }}</strong></span>
                    </td>
                    <td>
                        <span class="text-nowrap" title="Total network consensus weight across all relay types">{{ entry.total_consensus_weight_pct }}</span>
                    </td>
                    <td>
                        <span class="text-nowrap" title="Guard relay bandwidth capacity in {% if use_bits %}{{ entry.guard_bandwidth_unit }} (bits per second){% else %}{{ entry.guard_bandwidth_unit }} (bytes per second){% endif %}">{{ entry.guard_bandwidth }} {{ entry.guard_bandwidth_unit }}</span>
                    </td>
                    <td title="Geographic distribution of relay operations">{{ entry.country_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}

{# Exit Operators Table Complete Macro - Exit Champions #}
{% macro exit_operators_table_complete(exit_operators_data, use_bits, page_ctx) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-specialized-table">
            <thead>
                <tr>
                    <th title="Position in exit operators leaderboard based on exit relay count">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    <th title="Number of relays providing exit services to internet">Exit Relays</th>
                    <th title="Combined count of all relay types operated">Total Relays</th>
                    <th title="Exit relay bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Exit Bandwidth Capacity</th>
                    <th title="Percentage of total network consensus weight">Consensus Weight</th>
                    <th title="Number of countries with relay operations">Countries</th>
                    <th title="Number of relays providing guard services">Guard Count</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in exit_operators_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td><strong title="Active exit relays providing critical internet access points">{{ entry.exit_count }}</strong></td>
                    <td title="All relay types operated by this operator">{{ entry.total_relays }} <small class="text-muted">({{ entry.exit_percentage }})</small></td>
                    <td title="Exit relay bandwidth capacity in {% if use_bits %}{{ entry.exit_bandwidth_unit }} (bits per second){% else %}{{ entry.exit_bandwidth_unit }} (bytes per second){% endif %}">{{ entry.exit_bandwidth }} {{ entry.exit_bandwidth_unit }}</td>
                    <td title="Network consensus weight percentage">{{ entry.total_consensus_weight_pct }}</td>
                    <td title="Geographic reach across countries">{{ entry.country_count }}</td>
                    <td title="Number of guard relays providing network entry points">{{ entry.guard_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}

{# Guard Operators Table Complete Macro - Guard Gatekeepers #}
{% macro guard_operators_table_complete(guard_operators_data, use_bits, page_ctx) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-specialized-table">
            <thead>
                <tr>
                    <th title="Position in guard operators leaderboard based on guard relay count">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    <th title="Number of relays serving as entry points into the Tor network">Guard Relays</th>
                    <th title="Combined count of all relay types operated">Total Relays</th>
                    <th title="Guard relay bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Guard Bandwidth Capacity</th>
                    <th title="Percentage of total network consensus weight">Consensus Weight</th>
                    <th title="Number of countries with relay operations">Countries</th>
                    <th title="Number of relays providing exit services">Exit Count</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in guard_operators_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td><strong title="Active guard relays serving as critical network entry points">{{ entry.guard_count }}</strong></td>
                    <td title="All relay types operated by this operator">{{ entry.total_relays }} <small class="text-muted">({{ entry.guard_percentage }})</small></td>
                    <td title="Guard relay bandwidth capacity in {% if use_bits %}{{ entry.guard_bandwidth_unit }} (bits per second){% else %}{{ entry.guard_bandwidth_unit }} (bytes per second){% endif %}">{{ entry.guard_bandwidth }} {{ entry.guard_bandwidth_unit }}</td>
                    <td title="Network consensus weight percentage">{{ entry.total_consensus_weight_pct }}</td>
                    <td title="Geographic reach across countries">{{ entry.country_count }}</td>
                    <td title="Number of exit relays providing internet access points">{{ entry.exit_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}

{# Generic Ranking Table Paginated - Just the table part for pagination #}
{% macro generic_ranking_table_paginated(category_key, category_data, page_ctx, use_bits=false) %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table {% if category_key == 'non_eu_leaders' %}aroi-geographic-table{% elif category_key == 'frontier_builders' %}aroi-frontier-table{% elif category_key == 'platform_diversity' %}aroi-platform-table{% else %}aroi-category-table{% endif %}">
            <thead>
                <tr>
                    <th title="Position in leaderboard">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    {% if category_key != 'platform_diversity' and category_key != 'non_eu_leaders' and category_key != 'frontier_builders' %}
                    <th title="{% if category_key == 'network_veterans' %}Total relay count: number of relays currently operated. For veterans, higher relay counts with early start dates result in higher veteran scores{% elif category_key == 'reliability_masters' %}Total relay count: number of relays contributing to reliability calculations. More relays provide larger sample size for uptime measurements{% elif category_key == 'legacy_titans' %}Total relay count: number of relays contributing to long-term reliability scores. Sustained relay operations over 5 years demonstrate commitment{% elif category_key == 'bandwidth_masters' %}Total relay count: number of relays contributing to bandwidth calculations. More relays provide larger sample size for bandwidth served measurements{% elif category_key == 'bandwidth_legends' %}Total relay count: number of relays contributing to long-term bandwidth scores. Sustained relay operations over 5 years demonstrate commitment{% else %}Total number of relays operated by this operator{% endif %}">Relays</th>
                    {% endif %}
                    <th title="Primary ranking metric for 
                    {%- if category_key == 'most_diverse' -%}diversity score calculation
                    {%- elif category_key == 'platform_diversity' -%}non-Linux relay count
                    {%- elif category_key == 'non_eu_leaders' -%}non-EU relay count with percentage
                    {%- elif category_key == 'frontier_builders' -%}rare country relay count
                    {%- elif category_key == 'network_veterans' -%}veteran score calculation: days since first relay start date × total relay count. Higher scores indicate longer network service with more relays
                    {%- elif category_key == 'reliability_masters' -%}6-month reliability score: simple average uptime percentage from Onionoo API (25+ relays). Measures recent operational excellence and network reliability
                    {%- elif category_key == 'legacy_titans' -%}5-year reliability score: simple average uptime percentage from Onionoo API (25+ relays). Measures long-term operational stability and historical reliability
                    {%- elif category_key == 'bandwidth_masters' -%}6-month bandwidth score: simple average bandwidth served from Onionoo API (25+ relays). Measures recent bandwidth served performance and network contribution
                    {%- elif category_key == 'bandwidth_legends' -%}5-year bandwidth score: simple average bandwidth served from Onionoo API (25+ relays). Measures sustained bandwidth served capacity and long-term network contribution
                    {%- endif -%}">{% if category_key == 'platform_diversity' %}Non Linux Relays{% elif category_key == 'non_eu_leaders' %}Non-EU Relays{% elif category_key == 'frontier_builders' %}Rare Relays{% elif category_key == 'reliability_masters' %}Reliability Score{% elif category_key == 'legacy_titans' %}Legacy Score{% elif category_key == 'bandwidth_masters' %}Bandwidth Score{% elif category_key == 'bandwidth_legends' %}Bandwidth Score{% else %}Key Metric{% endif %}</th>
                    {% if category_key != 'bandwidth_masters' and category_key != 'bandwidth_legends' %}
                    <th title="Total observed bandwidth capacity in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">Bandwidth Capacity</th>
                    {% endif %}
                    {% if category_key != 'platform_diversity' %}
                    <th title="{% if category_key == 'network_veterans' %}Geographic distribution: number of countries with relay operations. Geographic diversity demonstrates network resilience and reduces single-point-of-failure risks{% elif category_key == 'reliability_masters' %}Geographic distribution: number of countries with relay operations. Geographic diversity for reliability indicates distributed operational infrastructure{% elif category_key == 'legacy_titans' %}Geographic distribution: number of countries with relay operations. Geographic diversity for long-term operators shows sustained international presence{% elif category_key == 'bandwidth_masters' %}Geographic distribution: number of countries with relay operations. Geographic diversity for bandwidth served operators indicates distributed service infrastructure{% elif category_key == 'bandwidth_legends' %}Geographic distribution: number of countries with relay operations. Geographic diversity for long-term bandwidth served operators shows sustained international presence{% else %}Number of countries with relay operations{% endif %}">Countries</th>
                    {% endif %}
                    {% if category_key != 'frontier_builders' and category_key != 'non_eu_leaders' and category_key != 'platform_diversity' %}
                    <th title="{% if category_key == 'network_veterans' %}Platform diversity: number of different operating systems used. Diversified platforms reduce monoculture risks and demonstrate technical sophistication{% elif category_key == 'reliability_masters' %}Platform diversity: number of different operating systems used. Platform diversity for reliable operators indicates varied technical infrastructure{% elif category_key == 'legacy_titans' %}Platform diversity: number of different operating systems used. Platform diversity for long-term operators shows sustained technical variety{% elif category_key == 'bandwidth_masters' %}Platform diversity: number of different operating systems used. Platform diversity for bandwidth served operators indicates varied technical infrastructure{% elif category_key == 'bandwidth_legends' %}Platform diversity: number of different operating systems used. Platform diversity for long-term bandwidth served operators shows sustained technical variety{% else %}Number of different operating systems used{% endif %}">Platforms</th>
                    {% endif %}
                    {% if category_key == 'most_diverse' %}
                    <th title="Number of unique Autonomous Systems (ASNs) used for network diversity">Unique AS</th>
                    {% elif category_key != 'reliability_masters' and category_key != 'legacy_titans' %}
                    <th title="Primary operational focus or unique contribution to Tor network">Specialization</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for entry in category_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    {% if category_key != 'platform_diversity' and category_key != 'non_eu_leaders' and category_key != 'frontier_builders' %}
                    <td title="Active relays currently contributing to Tor network">{{ entry.total_relays }}</td>
                    {% endif %}
                    <td>
                        <strong>
                        {% if category_key == 'most_diverse' %}<span title="{{ entry.diversity_breakdown_tooltip if entry.diversity_breakdown_tooltip else 'Diversity Score: Geographic (countries × 2.0) + Platform (OS types × 1.5) + Network (unique ASNs × 1.0)' }}">{{ entry.diversity_score }}</span>
                        {% elif category_key == 'platform_diversity' %}<span title="Relays promoting operating system diversity beyond Linux dominance">{{ entry.non_linux_count }}</span>
                        {% elif category_key == 'non_eu_leaders' %}<span title="Relays expanding Tor geographic reach beyond European Union concentration">{{ entry.non_eu_count_with_percentage }}</span>
                        {% elif category_key == 'frontier_builders' %}<span title="Relays in countries with strategic importance but underrepresented in Tor network">{{ entry.relays_in_rare_countries }}</span>
                        {% elif category_key == 'network_veterans' %}<span title="Veteran Score Calculation: {{ entry.veteran_tooltip if entry.veteran_tooltip else 'Days since first relay started × total relay count. Higher scores indicate longer continuous network service with more relays operated' }}">{{ entry.veteran_score }}</span>
                        {% elif category_key == 'reliability_masters' %}
                            <span title="{{ entry.reliability_tooltip }}">{{ entry.reliability_average }} avg</span>
                        {% elif category_key == 'legacy_titans' %}
                            <span title="{{ entry.reliability_tooltip }}">{{ entry.reliability_average }} avg</span>
                        {% elif category_key == 'bandwidth_masters' %}
                            <span title="{{ entry.bandwidth_tooltip }}">{{ entry.bandwidth_details_short }}</span>
                        {% elif category_key == 'bandwidth_legends' %}
                            <span title="{{ entry.bandwidth_tooltip }}">{{ entry.bandwidth_details_short }}</span>
                        {% endif %}
                        </strong>
                    </td>
                    {% if category_key != 'bandwidth_masters' and category_key != 'bandwidth_legends' %}
                    <td title="Observed bandwidth capacity in {% if use_bits %}{{ entry.bandwidth_unit }} (bits per second){% else %}{{ entry.bandwidth_unit }} (bytes per second){% endif %}">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</td>
                    {% endif %}
                    {% if category_key != 'platform_diversity' %}
                    <td title="Geographic distribution of relay operations">{{ entry.country_count }}</td>
                    {% endif %}
                    {% if category_key != 'frontier_builders' and category_key != 'non_eu_leaders' and category_key != 'platform_diversity' %}
                    <td title="Operating system diversity across relay infrastructure">{{ entry.platform_count }}</td>
                    {% endif %}
                    {% if category_key == 'most_diverse' %}
                    <td title="Number of unique Autonomous Systems providing network distribution">{{ entry.unique_as_count }}</td>
                    {% elif category_key != 'reliability_masters' and category_key != 'legacy_titans' %}
                    <td>
                        {% if category_key == 'platform_diversity' %}<span title="{{ entry.platform_breakdown_tooltip if entry.platform_breakdown_tooltip else 'Promoting operating system diversity beyond Linux dominance' }}">{{ entry.platform_breakdown_details if entry.platform_breakdown_details else 'OS diversity' }}</span>
                        {% elif category_key == 'non_eu_leaders' %}<span title="{{ entry.geographic_breakdown_tooltip }}">{{ entry.geographic_breakdown_details if entry.geographic_breakdown_details else 'Global expansion' }}</span>
                        {% elif category_key == 'frontier_builders' %}<span title="{{ entry.rare_country_tooltip }}">{{ entry.rare_country_details if entry.rare_country_details else 'Frontier presence' }}</span>
                        {% elif category_key == 'network_veterans' %}<span title="Network longevity specialization: {{ entry.veteran_tooltip if entry.veteran_tooltip else 'This operator has been contributing to the Tor network for an extended period, demonstrating long-term commitment and operational stability' }}">{{ entry.veteran_details_short if entry.veteran_details_short else 'Network longevity' }}</span>
                        {% endif %}
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %}



{# Unified IPv4/IPv6 Section Macro - Eliminates Duplication #}
{% macro ipv4_ipv6_section_paginated(category_key, category_name, category_data, icon, description, page_ctx, use_bits=false) %}
    <section id="{{ category_key }}" class="aroi-section">
        <h3 title="{{ description }}">{{ icon }} {{ category_name }}</h3>
        {% if category_data %}
        
        <!-- Page 1: Ranks 1-10 -->
        <div id="{{ category_key }}-1-10" class="pagination-section">
            <h4>{{ icon }} Ranks 1-10</h4>
            {{ ipv4_ipv6_table_paginated(category_key, category_data[:10], page_ctx, use_bits) }}
        </div>
        
        <!-- Page 2: Ranks 11-20 (only show if data exists) -->
        {% if category_data|length > 10 %}
        <div id="{{ category_key }}-11-20" class="pagination-section">
            <h4>{{ icon }} Ranks 11-20</h4>
            {{ ipv4_ipv6_table_paginated(category_key, category_data[10:20], page_ctx, use_bits) }}
        </div>
        {% endif %}
        
        <!-- Page 3: Ranks 21-25 (only show if data exists) -->
        {% if category_data|length > 20 %}
        <div id="{{ category_key }}-21-25" class="pagination-section">
            <h4>{{ icon }} Ranks 21-25</h4>
            {{ ipv4_ipv6_table_paginated(category_key, category_data[20:25], page_ctx, use_bits) }}
        </div>
        {% endif %}
        
        <!-- Pagination Navigation -->
        <div class="pagination-nav-bottom">
            <a href="#{{ category_key }}-1-10">1-10</a>
            {% if category_data|length > 10 %}<a href="#{{ category_key }}-11-20">11-20</a>{% endif %}
            {% if category_data|length > 20 %}<a href="#{{ category_key }}-21-25">21-25</a>{% endif %}
        </div>
        
        {% else %}
        <div class="alert alert-warning">
            <p>No data available for {{ category_name }}.</p>
        </div>
        {% endif %}
    </section>
{% endmacro %}

{# IPv4/IPv6 Address Leaders Table Macro - Optimized #}
{% macro ipv4_ipv6_table_paginated(category_key, category_data, page_ctx, use_bits=false) %}
    {% set is_ipv4 = category_key == 'ipv4_leaders' %}
    {% set ip_version = 'IPv4' if is_ipv4 else 'IPv6' %}
    <div class="table-responsive">
        <table class="table table-striped table-condensed aroi-rankings-table aroi-ip-address-table">
            <thead>
                <tr>
                    <th title="Position in {{ ip_version }} address leaders leaderboard">Rank</th>
                    <th title="Authenticated Relay Operator Identifier following ContactInfo specification">Operator (AROI)</th>
                    <th title="Number of unique {{ ip_version }} addresses used across relay infrastructure">Unique {{ ip_version }}</th>
                    <th title="Number of relays using {{ ip_version }} addresses">Relays</th>
                    <th title="Total bandwidth capacity on relays using {{ ip_version }} addresses">Bandwidth Capacity</th>
                    <th title="Consensus weight percentage on relays using {{ ip_version }} addresses">Consensus Weight</th>
                    <th title="Number of guard relays using {{ ip_version }} addresses">Guard</th>
                    <th title="Number of exit relays using {{ ip_version }} addresses">Exit</th>
                    <th title="Number of middle relays using {{ ip_version }} addresses">Middle</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in category_data %}
                <tr>
                    <td>{{ rank_badge(entry.rank) }}</td>
                    <td>{{ operator_link(entry, page_ctx) }}</td>
                    <td>
                        <strong title="{{ entry.ip_address_tooltip if entry.ip_address_tooltip else 'Unique ' + ip_version + ' addresses used across relay infrastructure' }}">
                            {{ entry.unique_ipv4_count if is_ipv4 else entry.unique_ipv6_count }}
                        </strong>
                    </td>
                    <td title="Active relays using {{ ip_version }} addresses">
                        {{ entry.ipv4_relay_count if is_ipv4 else entry.ipv6_relay_count }}
                    </td>
                    <td title="Bandwidth capacity on {{ ip_version }} relays in {% if use_bits %}bits per second{% else %}bytes per second{% endif %}">
                        {{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}
                    </td>
                    <td title="Consensus weight percentage on {{ ip_version }} relays">
                        {{ entry.ipv4_total_consensus_weight_pct if is_ipv4 else entry.ipv6_total_consensus_weight_pct }}
                    </td>
                    <td title="Guard relays using {{ ip_version }} addresses">
                        {{ entry.ipv4_guard_count if is_ipv4 else entry.ipv6_guard_count }}
                    </td>
                    <td title="Exit relays using {{ ip_version }} addresses">
                        {{ entry.ipv4_exit_count if is_ipv4 else entry.ipv6_exit_count }}
                    </td>
                    <td title="Middle relays using {{ ip_version }} addresses">
                        {{ entry.ipv4_middle_count if is_ipv4 else entry.ipv6_middle_count }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endmacro %} 

{# Universal Pagination Section Macro - Eliminates 12x duplicate pagination blocks in aroi-leaderboards.html #}
{# This macro creates the standard 3-section pagination pattern (1-10, 11-20, 21-25) used throughout the template #}
{% macro pagination_section(category_key, emoji, category_data, table_macro_name, page_ctx, use_bits=false) %}
    {% if category_data %}
    
    <!-- Page 1: Ranks 1-10 -->
    <div id="{{ category_key }}-1-10" class="pagination-section">
        <h4>{{ emoji }} Ranks 1-10</h4>
        {% if table_macro_name == 'bandwidth_table_complete' %}
            {{ bandwidth_table_complete(category_data[:10], use_bits, page_ctx) }}
        {% elif table_macro_name == 'consensus_weight_table_complete' %}
            {{ consensus_weight_table_complete(category_data[:10], use_bits, page_ctx) }}
        {% elif table_macro_name == 'exit_authority_table_complete' %}
            {{ exit_authority_table_complete(category_data[:10], use_bits, page_ctx) }}
        {% elif table_macro_name == 'guard_authority_table_complete' %}
            {{ guard_authority_table_complete(category_data[:10], use_bits, page_ctx) }}
        {% elif table_macro_name == 'exit_operators_table_complete' %}
            {{ exit_operators_table_complete(category_data[:10], use_bits, page_ctx) }}
        {% elif table_macro_name == 'guard_operators_table_complete' %}
            {{ guard_operators_table_complete(category_data[:10], use_bits, page_ctx) }}
        {% elif table_macro_name == 'generic_ranking_table_paginated' %}
            {{ generic_ranking_table_paginated(category_key, category_data[:10], page_ctx, use_bits) }}
        {% elif table_macro_name == 'ipv4_ipv6_table_paginated' %}
            {{ ipv4_ipv6_table_paginated(category_key, category_data[:10], page_ctx, use_bits) }}
        {% endif %}
    </div>
    
    <!-- Page 2: Ranks 11-20 (only show if data exists) -->
    {% if category_data|length > 10 %}
    <div id="{{ category_key }}-11-20" class="pagination-section">
        <h4>{{ emoji }} Ranks 11-20</h4>
        {% if table_macro_name == 'bandwidth_table_complete' %}
            {{ bandwidth_table_complete(category_data[10:20], use_bits, page_ctx) }}
        {% elif table_macro_name == 'consensus_weight_table_complete' %}
            {{ consensus_weight_table_complete(category_data[10:20], use_bits, page_ctx) }}
        {% elif table_macro_name == 'exit_authority_table_complete' %}
            {{ exit_authority_table_complete(category_data[10:20], use_bits, page_ctx) }}
        {% elif table_macro_name == 'guard_authority_table_complete' %}
            {{ guard_authority_table_complete(category_data[10:20], use_bits, page_ctx) }}
        {% elif table_macro_name == 'exit_operators_table_complete' %}
            {{ exit_operators_table_complete(category_data[10:20], use_bits, page_ctx) }}
        {% elif table_macro_name == 'guard_operators_table_complete' %}
            {{ guard_operators_table_complete(category_data[10:20], use_bits, page_ctx) }}
        {% elif table_macro_name == 'generic_ranking_table_paginated' %}
            {{ generic_ranking_table_paginated(category_key, category_data[10:20], page_ctx, use_bits) }}
        {% elif table_macro_name == 'ipv4_ipv6_table_paginated' %}
            {{ ipv4_ipv6_table_paginated(category_key, category_data[10:20], page_ctx, use_bits) }}
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Page 3: Ranks 21-25 (only show if data exists) -->
    {% if category_data|length > 20 %}
    <div id="{{ category_key }}-21-25" class="pagination-section">
        <h4>{{ emoji }} Ranks 21-25</h4>
        {% if table_macro_name == 'bandwidth_table_complete' %}
            {{ bandwidth_table_complete(category_data[20:25], use_bits, page_ctx) }}
        {% elif table_macro_name == 'consensus_weight_table_complete' %}
            {{ consensus_weight_table_complete(category_data[20:25], use_bits, page_ctx) }}
        {% elif table_macro_name == 'exit_authority_table_complete' %}
            {{ exit_authority_table_complete(category_data[20:25], use_bits, page_ctx) }}
        {% elif table_macro_name == 'guard_authority_table_complete' %}
            {{ guard_authority_table_complete(category_data[20:25], use_bits, page_ctx) }}
        {% elif table_macro_name == 'exit_operators_table_complete' %}
            {{ exit_operators_table_complete(category_data[20:25], use_bits, page_ctx) }}
        {% elif table_macro_name == 'guard_operators_table_complete' %}
            {{ guard_operators_table_complete(category_data[20:25], use_bits, page_ctx) }}
        {% elif table_macro_name == 'generic_ranking_table_paginated' %}
            {{ generic_ranking_table_paginated(category_key, category_data[20:25], page_ctx, use_bits) }}
        {% elif table_macro_name == 'ipv4_ipv6_table_paginated' %}
            {{ ipv4_ipv6_table_paginated(category_key, category_data[20:25], page_ctx, use_bits) }}
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Pagination Navigation (moved below tables) - only show links for pages with data -->
    <div class="pagination-nav-bottom">
        <a href="#{{ category_key }}-1-10">1-10</a>
        {% if category_data|length > 10 %}<a href="#{{ category_key }}-11-20">11-20</a>{% endif %}
        {% if category_data|length > 20 %}<a href="#{{ category_key }}-21-25">21-25</a>{% endif %}
    </div>
    
    {% else %}
    <div class="alert alert-warning">
        <p>No data available for this category.</p>
    </div>
    {% endif %}
{% endmacro %} 
