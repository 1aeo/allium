{% from "macros.html" import navigation %}
{% extends "skeleton.html" -%}

{% block title -%}
üè• Network Health Dashboard
{% endblock -%}

{% block body -%}

<div class="aroi-center-text aroi-subsection">
    <h1>üè• Tor Network Health Dashboard</h1>
    <p class="lead"><strong>Real-time Network Metrics Ribbon</strong></p>
</div>

{{ navigation('network_health', page_ctx) }}

<!-- COMPACT RIBBON DASHBOARD -->
<div class="network-health-ribbon">
    
    <!-- FIRST ROW -->
    <div class="ribbon-row">
        
        <!-- CARD 1: RELAY COUNTS -->
        <div class="ribbon-card relay-counts">
            <div class="card-header">
                <h4>üìä Relay Counts</h4>
            </div>
            <div class="card-metrics">
                <div class="metric-item primary">
                    <span class="metric-value"><a href="{{ page_ctx.path_prefix }}misc/all.html" style="color: inherit; text-decoration: none;">{{ "{:,}".format(relays.json.network_health.relays_total) }}</a></span>
                    <span class="metric-label">Total Relays</span>
                </div>
                <div class="metric-grid">
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.exit_count) }}</span>
                        <span class="metric-label">Exit</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.guard_count) }}</span>
                        <span class="metric-label">Guard</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.middle_count) }}</span>
                        <span class="metric-label">Middle</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.authorities_count) }}</span>
                        <span class="metric-label">Authorities</span>
                    </div>
                </div>
                <div class="metric-grid" style="grid-template-columns: 1fr; margin-top: 5px;">
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.bad_exits_count) }}</span>
                        <span class="metric-label">Bad Relays</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CARD 2: BANDWIDTH COUNTS -->
        <div class="ribbon-card bandwidth-counts">
            <div class="card-header">
                <h4>‚ö° Bandwidth Counts</h4>
            </div>
            <div class="card-metrics">
                <div class="metric-item primary">
                    <span class="metric-value">{{ relays.json.network_health.total_bandwidth_formatted }}</span>
                    <span class="metric-label">Total Bandwidth</span>
                </div>
                <div class="metric-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="metric-item">
                        <span class="metric-value">{{ relays.json.network_health.exit_bandwidth_formatted }}</span>
                        <span class="metric-label">Exit BW</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ relays.json.network_health.guard_bandwidth_formatted }}</span>
                        <span class="metric-label">Guard BW</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ relays.json.network_health.middle_bandwidth_formatted }}</span>
                        <span class="metric-label">Middle BW</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CARD 3: RELAY UPTIME -->
        <div class="ribbon-card relay-uptime">
            <div class="card-header">
                <h4>‚è∞ Relay Uptime</h4>
            </div>
            <div class="card-metrics">
                <div class="metric-item primary">
                    <span class="metric-value">{{ "%.1f%%"|format(relays.json.network_health.overall_uptime) }}</span>
                    <span class="metric-label">Overall Uptime</span>
                </div>
                <div class="metric-grid">
                    <div class="metric-item">
                        <span class="metric-value">{{ "%.1f%%"|format(relays.json.network_health.exit_uptime) }}</span>
                        <span class="metric-label">Exit Uptime</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "%.1f%%"|format(relays.json.network_health.guard_uptime) }}</span>
                        <span class="metric-label">Guard Uptime</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "%.1f%%"|format(relays.json.network_health.middle_uptime) }}</span>
                        <span class="metric-label">Middle Uptime</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "%.1f%%"|format(relays.json.network_health.bad_relay_uptime) }}</span>
                        <span class="metric-label">Bad Relay Uptime</span>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- SECOND ROW -->
    <div class="ribbon-row">
        
        <!-- CARD 4: OPERATOR PARTICIPATION -->
        <div class="ribbon-card operator-participation">
            <div class="card-header">
                <h4>üë• Operator Participation</h4>
            </div>
            <div class="card-metrics">
                <div class="metric-item primary">
                    <span class="metric-value"><a href="{{ page_ctx.path_prefix }}misc/contacts-by-bandwidth.html" style="color: inherit; text-decoration: none;">{{ "{:,}".format(relays.json.network_health.aroi_operators_count) }}</a></span>
                    <span class="metric-label">Unique AROI</span>
                </div>
                <div class="metric-grid">
                    <div class="metric-item">
                        <span class="metric-value"><a href="{{ page_ctx.path_prefix }}misc/families-by-bandwidth.html" style="color: inherit; text-decoration: none;">{{ "{:,}".format(relays.json.network_health.families_count) }}</a></span>
                        <span class="metric-label">Families</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value"><a href="{{ page_ctx.path_prefix }}misc/contacts-by-bandwidth.html" style="color: inherit; text-decoration: none;">{{ "{:,}".format(relays.json.network_health.unique_contacts_count) }}</a></span>
                        <span class="metric-label">Contacts</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.relays_with_family) }} | {{ "{:,}".format(relays.json.network_health.relays_without_family) }}</span>
                        <span class="metric-label">With | Without Family</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.relays_with_contact) }} | {{ "{:,}".format(relays.json.network_health.relays_without_contact) }}</span>
                        <span class="metric-label">With | Without Contact</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CARD 5: GEOGRAPHIC PARTICIPATION -->
        <div class="ribbon-card geographic-participation">
            <div class="card-header">
                <h4>üåç Geographic Participation</h4>
            </div>
            <div class="card-metrics">
                <div class="metric-item primary">
                    <span class="metric-value"><a href="{{ page_ctx.path_prefix }}misc/countries-by-bandwidth.html" style="color: inherit; text-decoration: none;">{{ "{:,}".format(relays.json.network_health.countries_count) }}</a></span>
                    <span class="metric-label">Unique Countries</span>
                </div>
                <div class="metric-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.eu_relays_count) }} | {{ "{:,}".format(relays.json.network_health.non_eu_relays_count) }}</span>
                        <span class="metric-label">EU | Non-EU Relays</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ "{:,}".format(relays.json.network_health.rare_countries_relays) }}</span>
                        <span class="metric-label">Rare Country Relays</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CARD 6: PROVIDER PARTICIPATION -->
        <div class="ribbon-card provider-participation">
            <div class="card-header">
                <h4>üè¢ Provider Participation</h4>
            </div>
            <div class="card-metrics">
                <div class="metric-item primary">
                    <span class="metric-value"><a href="{{ page_ctx.path_prefix }}misc/networks-by-bandwidth.html" style="color: inherit; text-decoration: none;">{{ "{:,}".format(relays.json.network_health.unique_as_count) }}</a></span>
                    <span class="metric-label">Unique AS</span>
                </div>
                <div class="metric-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="metric-item">
                        <span class="metric-value">{{ relays.json.network_health.avg_as_per_country }}</span>
                        <span class="metric-label">Avg AS/Country</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ relays.json.network_health.avg_aroi_per_as }}</span>
                        <span class="metric-label">Avg AROI/AS</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value">{{ relays.json.network_health.avg_families_per_as }}</span>
                        <span class="metric-label">Avg Families/AS</span>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- LAST UPDATED -->
    <div class="ribbon-footer">
        <p class="last-updated">Last updated: {{ page_ctx.timestamp_str }} UTC</p>
    </div>
    
</div>

{% endblock -%} 