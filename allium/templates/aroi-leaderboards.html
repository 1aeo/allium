{% from "macros.html" import navigation %}
{% from "aroi_macros.html" import champion_badge, top3_table, ranking_table_row, operator_link, rank_badge %}
{% extends "skeleton.html" -%}
{% block title -%}
    🏆 Tor Network Operator Champion Dashboard
{% endblock -%}
{% block body -%}

<div class="aroi-center-text aroi-subsection">
    <h1>🏆 Tor Network Operator Champion Dashboard</h1>
    <p class="lead"><strong>Live Performance Rankings for Authenticated Relay Operator Identifiers (AROI)</strong></p>
</div>

{{ navigation('aroi', page_ctx) }}

<!-- Quick Navigation -->
<nav class="well aroi-nav-spacing">
    <h4>📍 Quick Navigation</h4>
    
    <!-- Primary Navigation Row -->
    <div class="aroi-primary-nav">
        <a href="#champions" class="btn btn-md btn-primary">🏅 Champions</a>
        <a href="#podium" class="btn btn-md btn-info">🥇 Top 3</a>
        <a href="#rankings" class="btn btn-md btn-success">📊 Top 25 Rankings</a>
    </div>
    
    <!-- Category Navigation Row -->
    <div class="aroi-category-nav">
        <a href="#bandwidth" class="btn btn-sm btn-link">🚀 Bandwidth</a>
        <a href="#consensus_weight" class="btn btn-sm btn-link">⚖️ Consensus</a>
        <a href="#exit_authority" class="btn btn-sm btn-link" title="Highest exit consensus weight controlling where Tor traffic exits to the internet">🚪 Exit Authority</a>
        <a href="#exit_operators" class="btn btn-sm btn-link" title="Most exit relays operated, providing critical internet access points for Tor users">🚪 Exit Operators</a>
        <a href="#guard_operators" class="btn btn-sm btn-link" title="Most guard relays operated, serving as entry points into the Tor network">🛡️ Guard Operators</a>
        <a href="#most_diverse" class="btn btn-sm btn-link" title="Highest combined geographic, platform, and network diversity scores across relay operations">🌈 Most Diverse</a>
        <a href="#platform_diversity" class="btn btn-sm btn-link" title="Most non-Linux relays operated, promoting operating system diversity beyond Linux dominance">💻 Platform Diversity</a>
        <a href="#non_eu_leaders" class="btn btn-sm btn-link" title="Most relays operated outside the European Union, expanding Tor's geographic reach beyond EU concentration">🌍 Non-EU Leaders</a>
        <a href="#frontier_builders" class="btn btn-sm btn-link" title="Highest rare country scores from operating relays in strategically important but underrepresented countries">🏴‍☠️ Frontier Builders</a>
        <a href="#network_veterans" class="btn btn-sm btn-link" title="Longest-serving operators with earliest relay start dates, recognizing true network pioneers">🏆 Network Veterans</a>
    </div>
</nav>

<!-- Summary Stats -->
<div class="alert alert-info">
    <h4>🌟 Current Network Overview</h4>
    <div class="row">
        <div class="col-md-3">
            <strong><span title="Total unique operators with contact information">Total Operators:</span></strong><br>{{ relays.json.aroi_leaderboards.summary.total_operators }}
        </div>
        <div class="col-md-3">
            <strong><span title="Aggregate observed bandwidth capacity contributed to the Tor network by all operators with contact information">Combined Bandwidth:</span></strong><br>{{ relays.json.aroi_leaderboards.summary.total_bandwidth_formatted }}
        </div>
        <div class="col-md-3">
            <strong><span title="Percentage of total Tor network consensus weight held by operators with contact information">Network Consensus Weight:</span></strong><br>{{ relays.json.aroi_leaderboards.summary.total_consensus_weight_pct }}
        </div>
        <div class="col-md-3">
            <strong><span title="Number of competitive leaderboard categories tracking different aspects of operator performance and contribution">Live Categories:</span></strong><br>11 competitive leaderboards
        </div>
    </div>
    <div class="aroi-top-margin">
        <small class="text-muted">Last updated: {{ relays.json.aroi_leaderboards.summary.update_timestamp }}. Data refreshed every 30 minutes from the Tor directory authorities via <a href="https://onionoo.torproject.org/">Onionoo API</a>.</small>
    </div>
</div>

<!-- ===================================================================== -->
<!-- CURRENT WORLD LEADERS (Elite Champion Badges) -->
<!-- ===================================================================== -->
<section id="champions" class="aroi-section">
    <h2>🏅 Current World Leaders</h2>
    <p class="lead">Elite Champion Badges - Top performers across key categories</p>
    
    <div class="row">
        {{ champion_badge("bandwidth", relays.json.aroi_leaderboards.leaderboards.bandwidth, "Platinum Bandwidth", "🥇", "panel-warning", "aroi-champion-platinum", page_ctx.path_prefix) }}
        
        {{ champion_badge("consensus_weight", relays.json.aroi_leaderboards.leaderboards.consensus_weight, "Network Authority", "🏛️", "panel-warning", "aroi-champion-network", page_ctx.path_prefix) }}
        
        {{ champion_badge("exit_authority", relays.json.aroi_leaderboards.leaderboards.exit_authority, "Exit Authority Master", "🚪", "panel-danger", "aroi-champion-exit-authority", page_ctx.path_prefix) }}
        
        {{ champion_badge("exit_operators", relays.json.aroi_leaderboards.leaderboards.exit_operators, "Exit Gate Keeper", "🚪", "panel-warning", "aroi-champion-exit", page_ctx.path_prefix) }}
        
        {{ champion_badge("guard_operators", relays.json.aroi_leaderboards.leaderboards.guard_operators, "Guard Champion", "🛡️", "panel-info", "aroi-champion-guard", page_ctx.path_prefix) }}
        
        {{ champion_badge("most_diverse", relays.json.aroi_leaderboards.leaderboards.most_diverse, "Diversity Master", "🌍", "panel-success", "aroi-champion-diversity", page_ctx.path_prefix) }}
        
        {{ champion_badge("platform_diversity", relays.json.aroi_leaderboards.leaderboards.platform_diversity, "Platform Hero", "💻", "panel-info", "aroi-champion-platform", page_ctx.path_prefix) }}
        
        {{ champion_badge("non_eu_leaders", relays.json.aroi_leaderboards.leaderboards.non_eu_leaders, "Global Expansion Leader", "🌏", "panel-success", "aroi-champion-global", page_ctx.path_prefix) }}
        
        {{ champion_badge("frontier_builders", relays.json.aroi_leaderboards.leaderboards.frontier_builders, "Frontier Pioneer", "🏴‍☠️", "panel-default", "aroi-champion-frontier", page_ctx.path_prefix) }}
        
        {{ champion_badge("network_veterans", relays.json.aroi_leaderboards.leaderboards.network_veterans, "Network Veteran", "🏆", "panel-default", "aroi-champion-reliability", page_ctx.path_prefix) }}
    </div>
</section>

<!-- ===================================================================== -->
<!-- TOP 3 SUMMARY (Elite Tier Champions) -->
<!-- ===================================================================== -->
<section id="podium" class="aroi-section">
    <h2>🥇 Top 3 Summary</h2>
    <p class="lead">Elite Tier Champions - Podium winners across key categories</p>
    
    <!-- Bandwidth Titans -->
    {{ top3_table("Bandwidth Titans", "💪", relays.json.aroi_leaderboards.leaderboards.bandwidth, ["Bandwidth King", "Bandwidth Warrior", "Bandwidth Hero"], "bandwidth", page_ctx) }}

    <!-- Network Authority Elite -->
    {{ top3_table("Network Authority Elite", "🏛️", relays.json.aroi_leaderboards.leaderboards.consensus_weight, ["Authority Supreme", "Authority Commander", "Authority Captain"], "consensus_weight", page_ctx) }}

    <!-- Exit Authorities -->
    {{ top3_table("Exit Authorities", "🚪", relays.json.aroi_leaderboards.leaderboards.exit_authority, ["Exit Authority King", "Exit Authority Commander", "Exit Authority Captain"], "exit_authority", page_ctx) }}

    <!-- Exit Gate Keepers -->
    {{ top3_table("Exit Gate Keepers", "🚪", relays.json.aroi_leaderboards.leaderboards.exit_operators, ["Exit Master", "Exit Champion", "Exit Hero"], "exit_operators", page_ctx) }}

    <!-- Guard Champions -->
    {{ top3_table("Guard Champions", "🛡️", relays.json.aroi_leaderboards.leaderboards.guard_operators, ["Guard Commander", "Guard Captain", "Guard Leader"], "guard_operators", page_ctx) }}

    <!-- Diversity Masters -->
    {{ top3_table("Diversity Masters", "🌍", relays.json.aroi_leaderboards.leaderboards.most_diverse, ["Diversity Master", "Diversity Master", "Diversity Master"], "most_diverse", page_ctx) }}

    <!-- Platform Heroes -->
    {{ top3_table("Platform Heroes", "💻", relays.json.aroi_leaderboards.leaderboards.platform_diversity, ["Platform Hero", "Platform Hero", "Platform Hero"], "platform_diversity", page_ctx) }}

    <!-- Global Expansion Leaders -->
    {{ top3_table("Global Expansion Leaders", "🌏", relays.json.aroi_leaderboards.leaderboards.non_eu_leaders, ["Global Pioneer", "Global Explorer", "Global Ambassador"], "non_eu_leaders", page_ctx) }}

    <!-- Frontier Pioneers -->
    {{ top3_table("Frontier Pioneers", "🏴‍☠️", relays.json.aroi_leaderboards.leaderboards.frontier_builders, ["Frontier Pioneer", "Frontier Pioneer", "Frontier Pioneer"], "frontier_builders", page_ctx) }}

    <!-- Network Veterans -->
    {{ top3_table("Network Veterans", "🏆", relays.json.aroi_leaderboards.leaderboards.network_veterans, ["Veteran Legend", "Veteran Champion", "Veteran Hero"], "network_veterans", page_ctx) }}


</section>

<!-- ===================================================================== -->
<!-- COMPLETE RANKINGS (Full Leaderboards - All Categories Stacked) -->
<!-- ===================================================================== -->
<section id="rankings">
    <h2>📊 Complete Rankings</h2>
    <p class="lead">Full leaderboards with top 25 operators per category - All categories displayed for easy comparison and analysis</p>

    <!-- Category 1: Bandwidth Contributed -->
    <section id="bandwidth" class="aroi-section">
        <h3>🚀 Bandwidth Contributed - Top 25</h3>
        {% if relays.json.aroi_leaderboards.leaderboards.bandwidth %}
        <div class="table-responsive">
            <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Operator (AROI)</th>
                        <th>Relays</th>
                        <th>Bandwidth</th>
                        <th>Consensus Weight</th>
                        <th>Guard/Exit Count</th>
                        <th>Countries</th>
                        <th>Platforms</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in relays.json.aroi_leaderboards.leaderboards.bandwidth[:25] %}
                    <tr>
                        <td>
                            {% if entry.rank <= 3 %}
                                <span class="badge {% if entry.rank == 1 %}aroi-rank-gold{% elif entry.rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}">
                                    {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                                </span>
                            {% else %}
                                <span class="badge badge-default">{{ entry.rank }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info|escape }}" class="aroi-underline-link">
                                {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                                    <strong>{{ entry.aroi_domain|escape }}</strong>
                                {% else %}
                                    <strong>{{ entry.operator_key|escape }}</strong>
                                {% endif %}
                            </a>
                        </td>
                        <td>
                            <span title="Total: {{ entry.total_relays }} | Measured: {{ entry.measured_count }}">
                                {{ entry.total_relays }}
                                {% if entry.measured_count > 0 %}
                                    <small class="text-muted">({{ entry.measured_count }} measured)</small>
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <span class="text-nowrap"><strong>{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</strong></span>
                        </td>
                        <td>
                            <span class="text-nowrap">{{ entry.total_consensus_weight_pct }}</span>
                        </td>
                        <td>
                            <span title="Guard: {{ entry.guard_count }} | Exit: {{ entry.exit_count }} | Middle: {{ entry.middle_count }}">
                                🛡️{{ entry.guard_count }} / 🚪{{ entry.exit_count }}
                            </span>
                        </td>
                        <td>
                            <span title="Countries: {{ entry.countries|join(', ') }}">
                                {{ entry.country_count }}
                                {% if entry.countries|length > 0 %}
                                    <small class="text-muted">({{ entry.countries[:2]|join(', ') }}{% if entry.countries|length > 2 %}...{% endif %})</small>
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <span title="Platforms: {{ entry.platforms|join(', ') }}">
                                {{ entry.platform_count }}
                                {% if entry.non_linux_count > 0 %}
                                    <small class="text-success">({{ entry.non_linux_count }} non-Linux)</small>
                                {% endif %}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <p>No bandwidth data available.</p>
        </div>
        {% endif %}
    </section>

    <!-- Category 2: Network Authority Rankings -->
    <section id="consensus_weight" class="aroi-section">
        <h3>🏛️ Network Authority Rankings - Top 25</h3>
        {% if relays.json.aroi_leaderboards.leaderboards.consensus_weight %}
        <div class="table-responsive">
            <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Operator (AROI)</th>
                        <th>Relays</th>
                        <th>Network Authority</th>
                        <th>Bandwidth</th>
                        <th>Guard/Exit Count</th>
                        <th>Countries</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in relays.json.aroi_leaderboards.leaderboards.consensus_weight[:25] %}
                    <tr>
                        <td>
                            {% if entry.rank <= 3 %}
                                <span class="badge {% if entry.rank == 1 %}aroi-rank-gold{% elif entry.rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}">
                                    {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                                </span>
                            {% else %}
                                <span class="badge badge-default">{{ entry.rank }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info|escape }}" class="aroi-underline-link">
                                {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                                    <strong>{{ entry.aroi_domain|escape }}</strong>
                                {% else %}
                                    <strong>{{ entry.operator_key|escape }}</strong>
                                {% endif %}
                            </a>
                        </td>
                        <td>{{ entry.total_relays }}</td>
                        <td>
                            <span class="text-nowrap"><strong>{{ entry.total_consensus_weight_pct }}</strong></span>
                        </td>
                        <td>
                            <span class="text-nowrap">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</span>
                        </td>
                        <td>
                            <span title="Guard: {{ entry.guard_count }} | Exit: {{ entry.exit_count }}">
                                🛡️{{ entry.guard_count }} / 🚪{{ entry.exit_count }}
                            </span>
                        </td>
                        <td>{{ entry.country_count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </section>

    <!-- Category 3: Exit Authorities -->
    <section id="exit_authority" class="aroi-section">
        <h3>🚪 Exit Authorities - Top 25</h3>
        {% if relays.json.aroi_leaderboards.leaderboards.exit_authority %}
        <div class="table-responsive">
            <table class="table table-striped table-condensed aroi-rankings-table aroi-standard-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Operator (AROI)</th>
                        <th>Exit Relays</th>
                        <th>Exit Authority</th>
                        <th>Total Authority</th>
                        <th>Bandwidth</th>
                        <th>Countries</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in relays.json.aroi_leaderboards.leaderboards.exit_authority[:25] %}
                    <tr>
                        <td>
                            {% if entry.rank <= 3 %}
                                <span class="badge {% if entry.rank == 1 %}aroi-rank-gold{% elif entry.rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}">
                                    {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                                </span>
                            {% else %}
                                <span class="badge badge-default">{{ entry.rank }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info|escape }}" class="aroi-underline-link">
                                {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                                    <strong>{{ entry.aroi_domain|escape }}</strong>
                                {% else %}
                                    <strong>{{ entry.operator_key|escape }}</strong>
                                {% endif %}
                            </a>
                        </td>
                        <td>{{ entry.exit_count }}</td>
                        <td>
                            <span class="text-nowrap"><strong>{{ entry.exit_consensus_weight_pct }}</strong></span>
                        </td>
                        <td>
                            <span class="text-nowrap">{{ entry.total_consensus_weight_pct }}</span>
                        </td>
                        <td>
                            <span class="text-nowrap">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</span>
                        </td>
                        <td>{{ entry.country_count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </section>

    <!-- Category 4: Exit Gate Keepers -->
    <section id="exit_operators" class="aroi-section">
        <h3>🚪 Exit Gate Keepers - Top 25</h3>
        {% if relays.json.aroi_leaderboards.leaderboards.exit_operators %}
        <div class="table-responsive">
            <table class="table table-striped table-condensed aroi-rankings-table aroi-specialized-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Operator (AROI)</th>
                        <th>Exit Relays</th>
                        <th>Total Relays</th>
                        <th>Bandwidth</th>
                        <th>Consensus Weight</th>
                        <th>Countries</th>
                        <th>Guard Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in relays.json.aroi_leaderboards.leaderboards.exit_operators[:25] %}
                    <tr>
                        <td>
                            {% if entry.rank <= 3 %}
                                <span class="badge {% if entry.rank == 1 %}aroi-rank-gold{% elif entry.rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}">
                                    {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                                </span>
                            {% else %}
                                <span class="badge badge-default">{{ entry.rank }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                                <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info|escape }}" class="aroi-underline-link">
                                    <strong>{{ entry.aroi_domain|escape }}</strong>
                                </a>
                            {% else %}
                                <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" class="aroi-underline-link">
                                    <strong>{{ entry.operator_key|escape }}</strong>
                                </a>
                            {% endif %}
                        </td>
                        <td><strong>{{ entry.exit_count }}</strong></td>
                        <td>{{ entry.total_relays }}</td>
                        <td>{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</td>
                        <td>{{ entry.total_consensus_weight_pct }}</td>
                        <td>{{ entry.country_count }}</td>
                        <td>{{ entry.guard_count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </section>

    <!-- Category 5: Guard Champions -->
    <section id="guard_operators" class="aroi-section">
        <h3>🛡️ Guard Champions - Top 25</h3>
        {% if relays.json.aroi_leaderboards.leaderboards.guard_operators %}
        <div class="table-responsive">
            <table class="table table-striped table-condensed aroi-rankings-table aroi-specialized-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Operator (AROI)</th>
                        <th>Guard Relays</th>
                        <th>Total Relays</th>
                        <th>Bandwidth</th>
                        <th>Consensus Weight</th>
                        <th>Countries</th>
                        <th>Exit Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in relays.json.aroi_leaderboards.leaderboards.guard_operators[:25] %}
                    <tr>
                        <td>
                            {% if entry.rank <= 3 %}
                                <span class="badge {% if entry.rank == 1 %}aroi-rank-gold{% elif entry.rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}">
                                    {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                                </span>
                            {% else %}
                                <span class="badge badge-default">{{ entry.rank }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                                <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" class="aroi-underline-link">
                                    <strong>{{ entry.aroi_domain|escape }}</strong>
                                </a>
                            {% else %}
                                <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" class="aroi-underline-link">
                                    <strong>{{ entry.operator_key|escape }}</strong>
                                </a>
                            {% endif %}
                        </td>
                        <td><strong>{{ entry.guard_count }}</strong></td>
                        <td>{{ entry.total_relays }}</td>
                        <td>{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</td>
                        <td>{{ entry.total_consensus_weight_pct }}</td>
                        <td>{{ entry.country_count }}</td>
                        <td>{{ entry.exit_count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </section>

    <!-- Continue with remaining categories... -->
    {% for category_key in ['most_diverse', 'platform_diversity', 'non_eu_leaders', 'frontier_builders', 'network_veterans'] %}
        {% set category_name = relays.json.aroi_leaderboards.summary.categories[category_key] %}
        {% set category_data = relays.json.aroi_leaderboards.leaderboards[category_key] %}
        
        <section id="{{ category_key }}" class="aroi-section">
            <h3>
                {% if category_key == 'most_diverse' %}🌈{% elif category_key == 'platform_diversity' %}💻{% elif category_key == 'non_eu_leaders' %}🌍{% elif category_key == 'frontier_builders' %}🏴‍☠️{% elif category_key == 'network_veterans' %}🏆{% endif %} 
                {{ category_name }} - Top 25
            </h3>
            {% if category_data %}
            <div class="table-responsive">
                <table class="table table-striped table-condensed aroi-rankings-table aroi-category-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Operator (AROI)</th>
                            <th>Relays</th>
                            <th>Key Metric</th>
                            <th>Bandwidth</th>
                            <th>Countries</th>
                            <th>Platforms</th>
                            <th>Specialization</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in category_data[:25] %}
                        <tr>
                            <td>
                                {% if entry.rank <= 3 %}
                                    <span class="badge {% if entry.rank == 1 %}aroi-rank-gold{% elif entry.rank == 2 %}aroi-rank-silver{% else %}aroi-rank-bronze{% endif %}">
                                        {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                                    </span>
                                {% else %}
                                    <span class="badge badge-default">{{ entry.rank }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                                    <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" class="aroi-underline-link">
                                        <strong>{{ entry.aroi_domain|escape }}</strong>
                                    </a>
                                {% else %}
                                    <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" class="aroi-underline-link">
                                        <strong>{{ entry.operator_key|escape }}</strong>
                                    </a>
                                {% endif %}
                            </td>
                            <td>{{ entry.total_relays }}</td>
                            <td>
                                <strong>
                                {% if category_key == 'most_diverse' %}<span title="Diversity Score: Geographic (countries × 2.0) + Platform (OS types × 1.5) + Network (unique ASNs × 1.0)">{{ entry.diversity_score }}</span>
                                {% elif category_key == 'platform_diversity' %}{{ entry.non_linux_count }} non-Linux
                                {% elif category_key == 'non_eu_leaders' %}{{ entry.non_eu_count }} non-EU
                                {% elif category_key == 'frontier_builders' %}{{ entry.rare_country_count }} rare
                                {% elif category_key == 'network_veterans' %}{{ entry.veteran_score }}
                                {% endif %}
                                </strong>
                            </td>
                            <td>{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</td>
                            <td>{{ entry.country_count }}</td>
                            <td>{{ entry.platform_count }}</td>
                            <td>
                                {% if category_key == 'most_diverse' %}Geographic diversity
                                {% elif category_key == 'platform_diversity' %}OS diversity
                                {% elif category_key == 'non_eu_leaders' %}Global expansion
                                {% elif category_key == 'frontier_builders' %}<span title="{{ entry.rare_country_tooltip }}">{{ entry.rare_country_details if entry.rare_country_details else 'Frontier presence' }}</span>
                                {% elif category_key == 'network_veterans' %}<span title="{{ entry.veteran_tooltip }}">{{ entry.veteran_details_short if entry.veteran_details_short else 'Network longevity' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
                <p>No data available for {{ category_name }}.</p>
            </div>
            {% endif %}
        </section>
    {% endfor %}
</section>

<!-- Floating Back to Top Button -->
<a href="#champions" class="btn btn-primary aroi-fixed-nav">
    ↑ Back to Top
</a>

<!-- Additional Information -->
<section class="aroi-footer-section">
    <h3>📖 About AROI Leaderboards</h3>
    <div class="well">
        <p><strong>AROI (Authenticated Relay Operator Identifier)</strong> represents operators who provide contact information following the <a href="https://nusenu.github.io/ContactInfo-Information-Sharing-Specification/" target="_blank">ContactInfo Information Sharing Specification</a>.</p>
        
        <h4>Leaderboard Categories:</h4>
        <div class="row">
            <div class="col-md-6">
                <ul>
                    <li><strong>🚀 Bandwidth Contributed:</strong> Total observed bandwidth across all relays</li>
                    <li><strong>⚖️ Consensus Weight:</strong> Total consensus weight percentage in the network</li>
                    <li><strong>🚪 Exit Operators:</strong> Number of exit relays operated</li>
                    <li><strong>🛡️ Guard Operators:</strong> Number of guard relays operated</li>
                    <li><strong>🌈 Most Diverse:</strong> Geographic, platform, and network diversity score</li>
                    <li><strong>💻 Platform Diversity:</strong> Non-Linux relay operators promoting OS diversity</li>
                </ul>
            </div>
            <div class="col-md-6">
                <ul>

                    <li><strong>🌍 Non-EU Leaders:</strong> Geographic champions expanding Tor outside the EU</li>
                    <li><strong>🏴‍☠️ Frontier Builders:</strong> Operators in rare or underrepresented countries</li>
                    <li><strong>🏆 Network Veterans:</strong> Longest-serving operators with earliest relay start dates</li>
                </ul>
            </div>
        </div>
        
        <h4>🌈 Diversity Champion Scoring:</h4>
        <p><strong>Diversity Score Calculation:</strong> The diversity score uses a weighted formula to measure geographic, platform, and network diversity:</p>
        <ul>
            <li><strong>Geographic Component:</strong> Number of countries × 2.0 (highest weight for global presence)</li>
            <li><strong>Platform Component:</strong> Number of operating systems × 1.5 (promotes OS diversity beyond Linux)</li>
            <li><strong>Network Component:</strong> Number of unique ASNs × 1.0 (prevents concentration on single networks)</li>
        </ul>
        <p><em>Example:</em> An operator with relays in 5 countries, 3 operating systems, and 8 unique ASNs would score: (5 × 2.0) + (3 × 1.5) + (8 × 1.0) = 10.0 + 4.5 + 8.0 = <strong>22.5 diversity points</strong>.</p>
        
        
        <h4>🏴‍☠️ Frontier Builder Scoring:</h4>
        <p><strong>Rare Country Score Calculation:</strong> The rare country score sums up points from all countries where an operator runs relays using a weighted scoring system:</p>
        <ul>
            <li><strong>Relay Count Factor (4x weight):</strong> Countries with fewer relays receive higher scores (6 points for 1 relay, 5 points for 2 relays, down to 0 points for 7+ relays)</li>
            <li><strong>Network Percentage Factor (3x weight):</strong> Countries representing smaller portions of the network score higher (6 points for &lt;0.05%, 4 points for 0.05-0.1%, 2 points for 0.1-0.2%)</li>
            <li><strong>Geopolitical Factor (2x weight):</strong> Strategic importance based on conflict zones (3 points), authoritarian regimes (3 points), island nations (2 points), and developing countries (1-2 points)</li>
            <li><strong>Regional Factor (1x weight):</strong> Underrepresented regions like Africa, Central Asia, and Pacific Islands (2 points) or emerging regions (1 point)</li>
        </ul>
        <p><strong>Operator Scoring:</strong> Each operator's rare country score is the sum of points from all countries where they operate relays.</p>
        <p><em>Example:</em> An operator with 2 relays in Mongolia (44 points) and 1 relay in Malta (20 points) would score: 44 + 20 = <strong>64 total rare country points</strong>.</p>
        
        <h4>🏆 Network Veterans Scoring:</h4>
        <p><strong>Veteran Score Calculation:</strong> The veteran score recognizes operators with the longest continuous service to the Tor network using earliest first seen time weighted by operational scale:</p>
        <ul>
            <li><strong>Primary Factor - Earliest First Seen Time:</strong> Days between earliest relay's first_seen date and current date (primary ranking factor)</li>
            <li><strong>Secondary Factor - Relay Scale Multiplier:</strong> Tiered scaling from 1.0x to 1.3x based on total relay count (tiebreaker for similar veterans)</li>
            <li><strong>Micro Operators (1-9 relays):</strong> 1.0x scaling factor (no bonus)</li>
            <li><strong>Large Operators (100+ relays):</strong> 1.2x scaling factor (20% bonus for sustained commitment)</li>
            <li><strong>Top Tier Operators (300+ relays):</strong> 1.3x scaling factor (30% bonus for major operations)</li>
        </ul>
        <p><strong>Veteran Formula:</strong> veteran_score = veteran_days × veteran_relay_scaling_factor</p>
        <p><em>Example:</em> An operator running relays since 2010 (5,000 days) with 150 relays would score: 5,000 × 1.2 = <strong>6,000 veteran points</strong>, potentially beating a smaller operator from 2009 (5,453 days) who scores 5,453 × 1.0 = 5,453 points.</p>
        
        <p><strong>Data Sources:</strong> Live data from the Tor directory authorities via the Onionoo API, updated every 30 minutes. Rankings reflect current network status and operator contributions.</p>
    </div>
</section>

{% endblock -%} 
