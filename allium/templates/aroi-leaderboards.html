{% from "macros.html" import navigation %}
{% extends "skeleton.html" -%}
{% block title -%}
    🏆 Tor Network AROI Champions Dashboard
{% endblock -%}
{% block body -%}

<div style="text-align: center; margin-bottom: 20px;">
    <h1>🏆 Tor Network AROI Champions Dashboard</h1>
    <p class="lead"><strong>Live AROI Operator Leaderboards - Current Performance Rankings</strong></p>
</div>

{{ navigation('aroi', page_ctx) }}

<div class="alert alert-info">
    <h4>🌟 Current Champions Overview</h4>
    <ul style="margin-bottom: 0;">
        <li><strong>Total AROI Operators:</strong> {{ relays.json.aroi_leaderboards.summary.total_operators }}</li>
        <li><strong>Combined Bandwidth:</strong> {{ relays.json.aroi_leaderboards.summary.total_bandwidth_formatted }}</li>
        <li><strong>Network Consensus Weight:</strong> {{ relays.json.aroi_leaderboards.summary.total_consensus_weight_pct }}</li>
        <li><strong>Ranking Categories:</strong> 11 competitive leaderboards</li>
        <li><strong>Update Frequency:</strong> Every 30 minutes from live Onionoo data</li>
    </ul>
</div>

<p class="text-muted" style="margin-bottom: 15px;">
<small>Last updated: {{ relays.json.aroi_leaderboards.summary.update_timestamp }}. Data refreshed every 30 minutes from the Tor directory authorities via <a href="https://onionoo.torproject.org/">Tor Project's Onionoo API</a>.</small>
</p>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs" style="margin-bottom: 20px;">
    <li class="active"><a href="#bandwidth" data-toggle="tab">🚀 Bandwidth</a></li>
    <li><a href="#consensus_weight" data-toggle="tab">⚖️ Consensus Weight</a></li>
    <li><a href="#exit_operators" data-toggle="tab">🚪 Exit Operators</a></li>
    <li><a href="#guard_operators" data-toggle="tab">🛡️ Guard Operators</a></li>
    <li><a href="#most_diverse" data-toggle="tab">🌈 Most Diverse</a></li>
    <li><a href="#platform_diversity" data-toggle="tab">💻 Platform Diversity</a></li>
    <li><a href="#bsd_operators" data-toggle="tab">🔧 BSD Masters</a></li>
    <li><a href="#non_eu_leaders" data-toggle="tab">🌍 Non-EU Leaders</a></li>
    <li><a href="#frontier_builders" data-toggle="tab">🏴‍☠️ Frontier Builders</a></li>
    <li><a href="#network_veterans" data-toggle="tab">🏆 Veterans</a></li>
    <li><a href="#efficiency_champions" data-toggle="tab">⚡ Efficiency</a></li>
</ul>

<!-- Tab Content -->
<div class="tab-content">
    {% for category_key, category_name in relays.json.aroi_leaderboards.summary.categories.items() %}
    <div class="tab-pane{% if loop.first %} active{% endif %}" id="{{ category_key }}">
        <h3>{{ category_name }} - Top 25</h3>
        
        {% if relays.json.aroi_leaderboards.leaderboards[category_key] %}
        <table class="table table-striped table-condensed">
            <thead>
                <tr>
                    <th style="width: 5%;">Rank</th>
                    <th style="width: 20%;">Operator (AROI)</th>
                    <th style="width: 8%;">Relays</th>
                    <th style="width: 12%;">Bandwidth</th>
                    <th style="width: 10%;">Consensus Weight</th>
                    <th style="width: 15%;">Guard/Exit Count</th>
                    <th style="width: 8%;">Countries</th>
                    <th style="width: 8%;">Platforms</th>
                    <th style="width: 10%;">First Seen</th>
                    <th style="width: 4%;">AS</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in relays.json.aroi_leaderboards.leaderboards[category_key][:25] %}
                <tr>
                    <td>
                        {% if entry.rank <= 3 %}
                            <span class="badge" style="background-color: {% if entry.rank == 1 %}#FFD700{% elif entry.rank == 2 %}#C0C0C0{% else %}#CD7F32{% endif %};">
                                {% if entry.rank == 1 %}🥇{% elif entry.rank == 2 %}🥈{% else %}🥉{% endif %} {{ entry.rank }}
                            </span>
                        {% else %}
                            <span class="badge badge-default">{{ entry.rank }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if entry.aroi_domain and entry.aroi_domain != 'none' %}
                            <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info|escape }}" style="text-decoration: underline;">
                                <strong>{{ entry.aroi_domain|escape }}</strong>
                            </a>
                        {% elif entry.contact_info %}
                            <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" title="Contact: {{ entry.contact_info|escape }}" style="text-decoration: underline;" class="contact-text">
                                {{ entry.contact_info|truncate(20)|escape }}
                            </a>
                        {% else %}
                            <a href="{{ page_ctx.path_prefix }}contact/{{ entry.contact_hash }}/" style="text-decoration: underline;">
                                <em>{{ entry.operator_key|escape }}</em>
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        <span title="Total: {{ entry.total_relays }} | Measured: {{ entry.measured_count }}">
                            {{ entry.total_relays }}
                            {% if entry.measured_count > 0 %}
                                <small class="text-muted">({{ entry.measured_count }} measured)</small>
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <span class="text-nowrap">{{ entry.total_bandwidth }} {{ entry.bandwidth_unit }}</span>
                    </td>
                    <td>
                        <span class="text-nowrap">{{ entry.total_consensus_weight_pct }}</span>
                    </td>
                    <td>
                        <span title="Guard: {{ entry.guard_count }} | Exit: {{ entry.exit_count }} | Middle: {{ entry.middle_count }}">
                            🛡️{{ entry.guard_count }} / 🚪{{ entry.exit_count }}
                        </span>
                    </td>
                    <td>
                        <span title="Countries: {{ entry.countries|join(', ') }}">
                            {{ entry.country_count }}
                            {% if entry.countries|length > 0 %}
                                <small class="text-muted">({{ entry.countries[:2]|join(', ') }}{% if entry.countries|length > 2 %}...{% endif %})</small>
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <span title="Platforms: {{ entry.platforms|join(', ') }}">
                            {{ entry.platform_count }}
                            {% if entry.non_linux_count > 0 %}
                                <small class="text-success">({{ entry.non_linux_count }} non-Linux)</small>
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <span class="text-nowrap">{{ entry.first_seen_date }}</span>
                    </td>
                    <td>
                        <span title="Unique AS count">{{ entry.unique_as_count }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-warning">
            <p>No data available for this category. This may indicate that the data source is still being processed or that there are no operators meeting the criteria for this leaderboard.</p>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- Bootstrap Tab JavaScript (simplified, CSS-only fallback) -->
<script>
// Simple tab switching without jQuery
document.addEventListener('DOMContentLoaded', function() {
    var tabs = document.querySelectorAll('.nav-tabs a');
    var panes = document.querySelectorAll('.tab-pane');
    
    tabs.forEach(function(tab) {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active from all tabs and panes
            tabs.forEach(function(t) { t.parentElement.classList.remove('active'); });
            panes.forEach(function(p) { p.classList.remove('active'); });
            
            // Add active to clicked tab and corresponding pane
            this.parentElement.classList.add('active');
            var target = this.getAttribute('href').substring(1);
            document.getElementById(target).classList.add('active');
        });
    });
});
</script>

<!-- Additional Information -->
<div style="margin-top: 30px;">
    <h3>📖 About AROI Leaderboards</h3>
    <div class="well">
        <p><strong>AROI (Authenticated Relay Operator Identifier)</strong> represents operators who provide contact information following the <a href="https://nusenu.github.io/ContactInfo-Information-Sharing-Specification/" target="_blank">ContactInfo Information Sharing Specification</a>.</p>
        
        <h4>Leaderboard Categories:</h4>
        <ul>
            <li><strong>🚀 Bandwidth Contributed:</strong> Total observed bandwidth across all relays</li>
            <li><strong>⚖️ Consensus Weight:</strong> Total consensus weight percentage in the network</li>
            <li><strong>🚪 Exit Operators:</strong> Number of exit relays operated</li>
            <li><strong>🛡️ Guard Operators:</strong> Number of guard relays operated</li>
            <li><strong>🌈 Most Diverse:</strong> Geographic, platform, and network diversity score</li>
            <li><strong>💻 Platform Diversity:</strong> Non-Linux relay operators promoting OS diversity</li>
            <li><strong>🔧 BSD Masters:</strong> Technical leaders running BSD-based relays</li>
            <li><strong>🌍 Non-EU Leaders:</strong> Geographic champions expanding Tor outside the EU</li>
            <li><strong>🏴‍☠️ Frontier Builders:</strong> Operators in rare or underrepresented countries</li>
            <li><strong>🏆 Network Veterans:</strong> Most reliable operators with highest uptime</li>
            <li><strong>⚡ Efficiency Champions:</strong> Best consensus weight to bandwidth ratio</li>
        </ul>
        
        <p><strong>Data Sources:</strong> Live data from the Tor directory authorities via the Onionoo API, updated every 30 minutes. Rankings reflect current network status and operator contributions.</p>
    </div>
</div>

{% endblock -%} 